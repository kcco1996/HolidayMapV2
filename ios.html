<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Kieran‚Äôs Holiday Destinations Map (iOS Edition)</title>

  <!-- App Icons -->
  <link rel="icon" type="image/png" href="favicon.png">
  <link rel="apple-touch-icon" href="assets/app-icon.png">
  <meta name="theme-color" content="#2563eb">

  <!-- iOS-friendly viewport -->
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />

  <!-- Leaflet CSS -->
  <link rel="stylesheet"
        href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
        crossorigin="" />

  <style>
    html, body { height: 100%; margin: 0; padding: 0; }

    :root { --vh: 1vh; --controls-h: 0px; --vv-top: 0px; --strip-space: 86px; }

    body {
      overscroll-behavior: none;
      -webkit-overflow-scrolling: touch;
      background: #fff;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }

    #map{
      width: 100%;
      height: 100vh;
      height: 100dvh;
      height: calc(var(--vh) * 100);
      min-height: 100vh;
      touch-action: pan-x pan-y;
    }

    /* Popups */
    .popup .header { display:flex; align-items:center; gap:10px; }
    .popup .header img { width:40px; height:40px; object-fit:contain; }
    .popup .title { line-height:1.3; }

    .destination-icon { background: transparent; border: 0; }
    .destination-icon img { display: block; height: 20px; width: auto; }

    /* iOS popup hard fix */
    .leaflet-popup-content { max-height: 80vh; overflow: hidden; }
    .popup { max-height: 80vh; display: flex; flex-direction: column; }
    .popup .tab-content { flex: 1; overflow-y: auto; -webkit-overflow-scrolling: touch; min-height: 0; }

    /* Tabs */
    .tabs { display: flex; gap: 6px; margin-top: 8px; margin-bottom: 8px; flex-wrap: wrap; }
    .tab-btn {
      border: 1px solid #ccc; background: #f6f6f6; padding: 4px 8px; border-radius: 6px;
      cursor: pointer; font-size: 13px;
    }
    .tab-btn.active { background: #e7f0ff; border-color:#8db6ff; }
    .tab-panel { display:none; }
    .tab-panel.active { display:block; }

    .row { display:flex; align-items:center; gap:8px; margin: 6px 0; }
    .row label { font-size: 13px; min-width: 130px; }
    .row input[type="number"], .row input[type="text"], .row select { padding: 4px; }

    .hint { font-size: 12px; color:#666; margin-top:4px; }
    .save-bar { display:flex; gap:8px; margin-top:8px; }
    .btn {
      border:1px solid #bbb; background:#fff; padding:6px 10px; border-radius:6px; cursor:pointer; font-size:13px;
    }
    .btn.primary { background:#2563eb; color:#fff; border-color:#2563eb; }
    .btn.ghost { background:#f6f6f6; }
    .btn:disabled { opacity:0.6; cursor:not-allowed; }

    .textarea{
      width:100%; height:140px; padding:8px; border:1px solid #ccc; border-radius:6px;
      resize:vertical; font:13px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }

    .day-nav{ display:flex; align-items:center; gap:8px; margin:8px 0; flex-wrap:wrap; }
    .day-nav .btn{ padding:4px 8px; }
    .day-nav select{ padding:4px 8px; }

    .saved-toast{
      font-size:12px; color:#065f46; background:#ecfdf5; border:1px solid #a7f3d0;
      padding:4px 8px; border-radius:6px; display:none; margin-left:auto;
    }
    .saved-toast.show{ display:block; }

    /* Top bars */
    #controls-bar, #top-bar {
      position: fixed;
      z-index: 1000;
      background: rgba(255,255,255,0.95);
      border: 1px solid #ccc;
      padding: 8px 12px;
      border-radius: 8px;
      display:flex;
      gap:8px;
      align-items:center;
      font-size:13px;
      padding-top: calc(8px + env(safe-area-inset-top));
    }

    /* desktop defaults */
    #controls-bar { top: calc(10px + var(--vv-top)); left: 10px; right: auto; }
    #top-bar      { top: calc(10px + var(--vv-top)); right: 10px; }

    /* Mobile layout: stack bars and push them down correctly */
    @media (max-width: 640px) {
      #controls-bar {
        left: 10px;
        right: 10px;
        flex-wrap: wrap;
        top: calc(20px + var(--vv-top));
      }

      #top-bar {
        left: 10px;
        right: 10px;
        flex-wrap: wrap;
        justify-content: space-between;
        top: calc(10px + var(--vv-top) + var(--controls-h) + 10px);
      }
    }

    #controls-bar input, #controls-bar select {
      padding:4px 8px; border-radius:6px; border:1px solid #ccc; font-size:13px;
    }

    /* Wider popup */
    .leaflet-popup-content { width: 560px !important; }

    /* Migration/status box */
   #migration-status{
  display:none;
  position:fixed;

  top: calc(10px + var(--vv-top) + var(--controls-h) + 60px);
  right: 10px;
  left: auto;

  background:#ffffff;
  border:1px solid #cbd5e1;
  padding:10px 14px;
  max-width:340px;
  font-size:13px;
  line-height:1.4;
  z-index:1001;
  box-shadow:0 4px 12px rgba(0,0,0,0.15);
  border-radius:10px;
  opacity:0;
  transform: translateY(-10px);
  transition: opacity 0.3s ease, transform 0.3s ease;
}

#migration-status.show{
  display:block;
  opacity:1;
  transform: translateY(0);
}

    /* iOS: prevent input zoom when font-size < 16px */
    input, select, textarea { font-size: 16px; }
    .btn, .tab-btn, .hint, .row label { font-size: 13px; }

    /* loading hint inside popup */
    .loading-hint {
      font-size: 12px;
      color: #444;
      background: #f3f4f6;
      border: 1px solid #e5e7eb;
      padding: 6px 8px;
      border-radius: 8px;
      margin-top: 8px;
    }

    /* === Gatwick / Departures board strip (bottom) === */
    .departures-strip{
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 9999;

      padding: 10px 12px;
      background: rgba(10, 12, 18, 0.96);
      border-top: 1px solid rgba(255,255,255,0.10);
      backdrop-filter: blur(10px);

      transform: translateY(0);
      transition: transform 220ms ease;
      padding-bottom: calc(10px + env(safe-area-inset-bottom));
    }

    .departures-strip__inner{ max-width: 1200px; margin: 0 auto; }
    .departures-strip__label{
      font-weight: 800;
      letter-spacing: 0.14em;
      font-size: 12px;
      color: rgba(255,255,255,0.75);
      margin: 0 0 8px 2px;
    }

    .departures-strip__grid{
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 10px;
    }
    .departures-strip__grid--6{ grid-template-columns: repeat(6, minmax(0, 1fr)); }

    @media (max-width: 900px){
      .departures-strip__grid--6{ grid-template-columns: repeat(3, minmax(0, 1fr)); }
    }
    @media (max-width: 640px){
      .departures-strip__grid--6{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }

    .departures-strip__bar{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;

      position: sticky;
      top: 0;
      z-index: 2;

      background: rgba(10,12,18,0.98);
      padding-bottom: 8px;
      margin-bottom: 10px;
    }

    .departures-strip__toggle{
      appearance: none;
      -webkit-appearance: none;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(0,0,0,0.35);
      color: rgba(255,255,255,0.85);
      border-radius: 999px;
      padding: 6px 10px;
      font: 700 12px/1 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      letter-spacing: 0.10em;
      cursor: pointer;
    }

    .departures-strip__toggle:active{ transform: translateY(1px); }

    /* Collapsed state */
    .departures-strip.is-collapsed{
      transform: translateY(calc(100% - 52px));
    }

    .leaflet-bottom.leaflet-left,
    .leaflet-bottom.leaflet-right{
      margin-bottom: var(--strip-space);
    }

    .db-cell{
      border: 1px solid rgba(255,255,255,0.10);
      border-radius: 10px;
      padding: 8px 10px;
      background: rgba(0,0,0,0.28);
      min-width: 0;
    }

    .db-cell__head{
      font-size: 11px;
      letter-spacing: 0.18em;
      color: rgba(255,255,255,0.65);
      margin-bottom: 6px;
    }

    .db-cell__value{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-weight: 900;
      font-size: 18px;
      letter-spacing: 0.08em;
      line-height: 1.1;
      color: #ffd34d;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    @media (max-width: 640px){
      .departures-strip{ padding: 8px 10px; padding-bottom: calc(8px + env(safe-area-inset-bottom)); }
      .departures-strip.is-collapsed{ transform: translateY(calc(100% - 48px)); }
      .departures-strip__toggle{ font-size: 11px; padding: 5px 9px; }
      .db-cell__value{ font-size: 16px; }
    }

    #top-toast{
  display:none;
  max-width: 360px;
  background:#ffffff;
  border:1px solid #cbd5e1;
  padding:10px 12px;
  font-size:13px;
  line-height:1.35;
  border-radius:10px;
  box-shadow:0 4px 12px rgba(0,0,0,0.15);
}

#top-toast.show{
  display:block;
}

  </style>
</head>

<body>
  <div id="map"></div>

  <footer class="departures-strip" id="departuresStrip" aria-label="Next trip departures board">
    <div class="departures-strip__inner">
      <div class="departures-strip__bar">
        <div class="departures-strip__label" style="margin:0;">NEXT TRIP</div>
        <button class="departures-strip__toggle" id="departuresToggle" type="button" aria-expanded="true">HIDE</button>
      </div>

      <div class="departures-strip__grid departures-strip__grid--6" role="group" aria-label="Departure details">
        <div class="db-cell"><div class="db-cell__head">OUT DATE</div><div class="db-cell__value" id="nextTripOutDate">‚Äî</div></div>
        <div class="db-cell"><div class="db-cell__head">OUT TIME</div><div class="db-cell__value" id="nextTripOutTime">‚Äî</div></div>
        <div class="db-cell"><div class="db-cell__head">RETURN DATE</div><div class="db-cell__value" id="nextTripReturnDate">‚Äî</div></div>
        <div class="db-cell"><div class="db-cell__head">RETURN TIME</div><div class="db-cell__value" id="nextTripReturnTime">‚Äî</div></div>
        <div class="db-cell"><div class="db-cell__head">OPERATOR</div><div class="db-cell__value" id="nextTripOperator">‚Äî</div></div>
        <div class="db-cell"><div class="db-cell__head">FLIGHT</div><div class="db-cell__value" id="nextTripFlight">‚Äî</div></div>
      </div>
    </div>
  </footer>

  <div id="controls-bar">
    <input type="text" id="search-input" placeholder="Search destination..." />
    <select id="region-filter">
      <option value="all">üåç All Regions</option>
      <option value="north-america">North America</option>
      <option value="south-america">South America</option>
      <option value="europe">Europe</option>
      <option value="africa">Africa</option>
      <option value="asia">Asia</option>
      <option value="oceania">Oceania</option>
    </select>
    <button id="reset-view" class="btn ghost">Show All</button>

    <span id="icon-counts" style="margin-left:8px; font-weight:600;">
      üè¥ Flags: 0 | ‚ö´ Dots: 0
    </span>
  </div>

  <div id="top-bar">
    <button id="sign-in-btn" class="btn" onclick="firebaseSignIn()">Sign in with Google</button>
    <button id="sign-out-btn" class="btn" onclick="firebaseSignOut()" style="display:none;">Sign out</button>
    <span id="user-info"></span>
    <div id="migrate-wrap" style="display:none; flex-direction:column; gap:6px; align-items:flex-start;">
  <button id="migrate-btn" class="btn ghost">Migrate Data to Firebase</button>
  <div id="top-toast" aria-live="polite"></div>
</div>
  </div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
          integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
          crossorigin=""></script>

  <script>
    // -------------------------
    // iOS viewport height fix
    // -------------------------
    function setVh() {
      const h =
        (window.visualViewport && window.visualViewport.height) ?
          window.visualViewport.height :
          window.innerHeight;

      const safeH = Math.max(320, h);
      document.documentElement.style.setProperty('--vh', `${safeH * 0.01}px`);
    }
    setVh();
    window.addEventListener('resize', setVh, { passive: true });
    if (window.visualViewport) {
      window.visualViewport.addEventListener('resize', setVh, { passive: true });
      window.visualViewport.addEventListener('scroll', setVh, { passive: true });
    }

    // -------------------------
    // Top-bar stacking helper (mobile)
    // -------------------------
    function updateBarsLayout() {
      const cb = document.getElementById("controls-bar");
      if (!cb) return;

      const h = cb.getBoundingClientRect().height || 0;
      document.documentElement.style.setProperty("--controls-h", `${Math.ceil(h)}px`);

      const vvTop = (window.visualViewport && typeof window.visualViewport.offsetTop === "number")
        ? window.visualViewport.offsetTop
        : 0;

      document.documentElement.style.setProperty("--vv-top", `${Math.ceil(vvTop)}px`);
    }

    window.addEventListener("load", updateBarsLayout, { passive: true });
    window.addEventListener("resize", updateBarsLayout, { passive: true });
    if (window.visualViewport) {
      window.visualViewport.addEventListener("resize", updateBarsLayout, { passive: true });
      window.visualViewport.addEventListener("scroll", updateBarsLayout, { passive: true });
    }

    // -------------------------
    // iOS-safe storage wrapper
    // -------------------------
    const safeStorage = (() => {
      let mem = {};
      function canUseLocalStorage() {
        try {
          const k = "__test__";
          localStorage.setItem(k, "1");
          localStorage.removeItem(k);
          return true;
        } catch {
          return false;
        }
      }
      const ok = canUseLocalStorage();
      return {
        getItem(key) {
          try { return ok ? localStorage.getItem(key) : (mem[key] ?? null); }
          catch { return mem[key] ?? null; }
        },
        setItem(key, val) {
          try { ok ? localStorage.setItem(key, val) : (mem[key] = String(val)); }
          catch { mem[key] = String(val); }
        },
        removeItem(key) {
          try { ok ? localStorage.removeItem(key) : delete mem[key]; }
          catch { delete mem[key]; }
        },
        keys() {
          try { return ok ? Object.keys(localStorage) : Object.keys(mem); }
          catch { return Object.keys(mem); }
        }
      };
    })();

    window.safeStorage = safeStorage;

    // -------------------------
    // Large-value storage (chunking)
    // -------------------------
    const CHUNK_SIZE = 8000;

    function setLargeItem(key, valueStr) {
      const storage = safeStorage;
      const oldCount = Number(storage.getItem(`${key}::__chunks`) || 0);
      for (let i = 0; i < oldCount; i++) storage.removeItem(`${key}::__chunk:${i}`);
      storage.removeItem(`${key}::__chunks`);

      const chunks = Math.ceil(valueStr.length / CHUNK_SIZE);
      storage.setItem(`${key}::__chunks`, String(chunks));
      for (let i = 0; i < chunks; i++) {
        const part = valueStr.slice(i * CHUNK_SIZE, (i + 1) * CHUNK_SIZE);
        storage.setItem(`${key}::__chunk:${i}`, part);
      }
    }

    function getLargeItem(key) {
      const storage = safeStorage;
      const chunks = Number(storage.getItem(`${key}::__chunks`) || 0);
      if (!chunks) return null;
      let out = "";
      for (let i = 0; i < chunks; i++) out += (storage.getItem(`${key}::__chunk:${i}`) || "");
      return out || null;
    }

    function removeLargeItem(key) {
      const storage = safeStorage;
      const chunks = Number(storage.getItem(`${key}::__chunks`) || 0);
      for (let i = 0; i < chunks; i++) storage.removeItem(`${key}::__chunk:${i}`);
      storage.removeItem(`${key}::__chunks`);
    }

    function normalizeName(s) { return String(s || "").trim().toLowerCase(); }

    let DEST_NAME_LOOKUP = new Map();
    function canonicalDestinationName(inputName) {
      const n = normalizeName(inputName);
      return DEST_NAME_LOOKUP.get(n) || String(inputName || "").trim();
    }
    function storageKey(name) { return `tripPlan:${canonicalDestinationName(name)}`; }

    function findExistingPlanKey(name) {
      const exact = storageKey(name);
      const exactRaw = getLargeItem(exact);
      if (exactRaw) return exact;

      const target = normalizeName(name);
      const keys = (safeStorage.keys?.() || []);
      for (const k of keys) {
        if (!k.startsWith("tripPlan:")) continue;
        if (!k.endsWith("::__chunks")) continue;

        const base = k.replace("::__chunks", "");
        const baseName = base.slice("tripPlan:".length);
        if (normalizeName(baseName) === target) return base;
      }
      return exact;
    }

    function makeEmptyPlan(days = 1) {
      const d = Math.max(1, Number(days || 1));
     const base = {
  days: d,
  activities: { 1: "" },
  notes: "",
  tips: "",
  hotel: { name:"", currency:"GBP", nightly:"", nights: Math.max(1, d - 1), notes:"" },
  budget: {
    cheap:  { name:"", currency:"GBP", price:"", nights:"", notes:"" },
    luxury: { name:"", currency:"GBP", price:"", nights:"", notes:"" }
  },

  flights: {
    out: { date: "", time: "" },
    ret: { date: "", time: "" },
    operator: "",
    flightCode: "",
    journey: { outDuration: "", returnDuration: "" },
    layoverDuration: "",
    notes: ""
  },

  food: {}
};
      for (let i = 1; i <= d; i++) {
        base.food[i] = {
          breakfast: { dish:"", hot:"", cold:"", description:"", hotDescription:"", coldDescription:"" },
          lunch:     { dish:"", hot:"", cold:"", description:"", hotDescription:"", coldDescription:"" },
          dinner:    {
            starter:"", main:"", dessert:"",
            alcoholic:"", cold:"",
            starterDescription:"", mainDescription:"", dessertDescription:"",
            alcoholDescription:"", coldDescription:"",
            description:""
          }
        };
      }
      return base;
    }

    function normalizePlanShape(plan) {
      const base = makeEmptyPlan(plan?.days || 1);
      if (!plan || typeof plan !== "object") return base;

      if (typeof plan.days !== "number" || plan.days < 1) plan.days = 1;
      if (!plan.activities) plan.activities = {1:""};
      if (typeof plan.notes !== "string") plan.notes = "";
      if (typeof plan.tips !== "string") plan.tips = "";

      if (!plan.hotel) plan.hotel = { ...base.hotel };
      if (!("notes" in plan.hotel)) plan.hotel.notes = "";

      if (!plan.budget) plan.budget = { ...base.budget };
      if (!plan.budget.cheap) plan.budget.cheap = { ...base.budget.cheap };
      if (!plan.budget.luxury) plan.budget.luxury = { ...base.budget.luxury };

      // Flights
if (!plan.flights) plan.flights = JSON.parse(JSON.stringify(base.flights));
if (!plan.flights.out) plan.flights.out = { date:"", time:"" };
if (!plan.flights.ret) plan.flights.ret = { date:"", time:"" };
if (!("operator" in plan.flights)) plan.flights.operator = "";
if (!("flightCode" in plan.flights)) plan.flights.flightCode = "";
if (!plan.flights.journey) plan.flights.journey = { outDuration:"", returnDuration:"" };
if (!("outDuration" in plan.flights.journey)) plan.flights.journey.outDuration = "";
if (!("returnDuration" in plan.flights.journey)) plan.flights.journey.returnDuration = "";
if (!("layoverDuration" in plan.flights)) plan.flights.layoverDuration = "";
if (!("notes" in plan.flights)) plan.flights.notes = "";

      if (plan.foodDiary && !plan.food) { plan.food = {}; delete plan.foodDiary; }
      if (!plan.food || typeof plan.food !== "object" || Array.isArray(plan.food)) plan.food = {};

      for (let i=1; i<=plan.days; i++){
        if (!(i in plan.activities)) plan.activities[i] = "";
        if (!plan.food[i]) plan.food[i] = JSON.parse(JSON.stringify(base.food[i]));
      }

      Object.keys(plan.activities).map(k=>+k).filter(k=>k>plan.days).forEach(k=>delete plan.activities[k]);
      Object.keys(plan.food).map(k=>+k).filter(k=>k>plan.days).forEach(k=>delete plan.food[k]);

      return plan;
    }

    function loadPlanLocal(name){
      const key = findExistingPlanKey(name);
      const raw = getLargeItem(key);

      let plan;
      try { plan = raw ? JSON.parse(raw) : makeEmptyPlan(1); }
      catch { plan = makeEmptyPlan(1); }

      return normalizePlanShape(plan);
    }

    function savePlanLocal(name, data){
      const key = storageKey(name);
      const plan = normalizePlanShape(data);
      setLargeItem(key, JSON.stringify(plan));
    }

    window.canonicalDestinationName = canonicalDestinationName;
    window.loadPlanLocal = loadPlanLocal;
    window.savePlanLocal = savePlanLocal;

    async function loadPlanFromFirebaseIfSignedIn(name) {
      const user = window.firebaseAuth?.currentUser;
      const db = window.firebaseDB;
      const getDoc = window.getDoc;
      const docFn = window.doc;

      let plan = loadPlanLocal(name);

      if (!user || !db || !getDoc || !docFn) return { plan, from: "local" };

      try {
        const snap = await getDoc(docFn(db, "users", user.uid, "plans", name));
        if (snap.exists()) {
          const dataObj = snap.data() || {};
          const cloudPlan = normalizePlanShape(dataObj.data || dataObj);
          plan = cloudPlan;
          savePlanLocal(name, plan);
          safeStorage.setItem(`hasPlan:${canonicalDestinationName(name)}`, "1");
          return { plan, from: "firebase" };
        }
      } catch (e) {
        console.warn("Firebase plan load failed for", name, e);
      }
      return { plan, from: "local" };
    }

    async function savePlanToFirebaseIfSignedIn(name, plan) {
      const user = window.firebaseAuth?.currentUser;
      const db = window.firebaseDB;
      const setDoc = window.setDoc;
      const docFn = window.doc;

      if (!user || !db || !setDoc || !docFn) return false;

      try {
        await setDoc(
          docFn(db, "users", user.uid, "plans", name),
          { name, data: plan, updatedAt: Date.now() },
          { merge: true }
        );
        safeStorage.setItem(`hasPlan:${canonicalDestinationName(name)}`, "1");
        return true;
      } catch (e) {
        console.warn("Firebase plan save failed for", name, e);
        return false;
      }
    }

    function destinationIcon(url) {
      return L.divIcon({
        html: `<img src="${url}" alt="">`,
        className: 'destination-icon',
        iconSize: [40, 40],
        iconAnchor: [20, 20],
        popupAnchor: [0, -18]
      });
    }

    // === Next Trip Departures Strip ===
    function setNextTripBoard({ outDate, outTime, returnDate, returnTime, operator, flightCode }) {
      const set = (id, val) => {
        const el = document.getElementById(id);
        if (el) el.textContent = val || "‚Äî";
      };
      set("nextTripOutDate", outDate);
      set("nextTripOutTime", outTime);
      set("nextTripReturnDate", returnDate);
      set("nextTripReturnTime", returnTime);
      set("nextTripOperator", operator);
      set("nextTripFlight", flightCode);
    }

    setNextTripBoard({
      outDate: "27/02/2026",
      outTime: "22:05",
      returnDate: "07/03/2026",
      returnTime: "19:30",
      operator: "Cathay Pacific",
      flightCode: "CX254"
    });

    // === HOLIDAY DESTINATIONS ===
    const destinations = [

    // North America

    // Burbank, Kingman, Williams, Flagstaff, Albuquerque, San Antonio, Dallas, Cincinnati, Milwaukee, Springfield IL, St Louis
    // Oklahoma City, Minneapolis, Lancaster, Gettysburg, Pittsburgh, Williamsburg, Norfolk VA, Montgomery, Niagara Falls, Winnipeg
    // Saskatoon, Calgary, Portland OR, Anchorage, Cienfuegos, Trinidad, Santiago de Cuba
           {
        name: "Seattle",
        lat: 47.60772453397215,  lng: -122.33571831316796,  
        destination: "assets/black-dot.png",  
        note: "-",
        region: "north-america"
      },
           {
        name: "Vancouver",
        lat: 49.28239845936347, lng: -123.1201280732361,    
        destination: "assets/black-dot.png",  
         note: "-",
        region: "north-america"
      },
           {
        name: "Banff",
        lat: 51.17832458370294, lng: -115.5707963532298,    
        destination: "assets/black-dot.png",  
         note: "-",
        region: "north-america"
      },
           {
        name: "Detroit",
        lat: 42.329879544353226, lng: -83.0409047870654,    
        destination: "assets/black-dot.png",  
         note: "-",
        region: "north-america"
      },
         {
        name: "Toronto",
        lat:  43.652627129818654, lng: -79.38432555629761,  
        destination: "assets/black-dot.png",  
        note: "-",
        region: "north-america"
      },
           {
        name: "Ottawa",
        lat: 45.41997247826557, lng: -75.70000171763027,    
        destination: "assets/black-dot.png",  
        note: "-",
        region: "north-america"
      },
           {
        name: "Montreal",
        lat: 45.503463342454616, lng: -73.56769621488876,    
        destination: "assets/black-dot.png",  
        note: "-",
        region: "north-america"
      },
           {
        name: "Quebec City",
        lat: 46.812554109739246, lng: -71.2081315885433,    
        destination: "assets/black-dot.png",  
        note: "-",
        region: "north-america"
      },
        {
        name: "New York City",
        lat: 40.71209411855515, lng: -74.00500529400429,   
        destination: "assets/black-dot.png",  
        note: "-",
        region: "north-america"
      },
           {
        name: "Philadelphia",
        lat: 39.95362138471616, lng: -75.15725298609271,    
        destination: "assets/black-dot.png",  
        note: "-",
        region: "north-america"
      },
           {
        name: "Boston",
        lat: 42.355756353550504, lng: -71.05980501991988,    
        destination: "assets/black-dot.png",  
        note: "-",
        region: "north-america"
      },
           {
        name: "Washington DC",
        lat: 38.90950627319311, lng: -77.0378603298129,    
        destination: "assets/black-dot.png",  
        note: "-",
        region: "north-america"
      },
         {
        name: "Charlotte",
        lat: 35.22068845703077, lng: -80.84207585899921,    
        destination: "assets/black-dot.png",  
        note: "-",
        region: "north-america"
      },
           {
        name: "Kentucky Bourbon Trail",
        lat: 36.96615901727974, lng: -86.18277184438787,    
        destination: "assets/black-dot.png",  
        note: "-",
        region: "north-america"
      },
           {
        name: "Chicago",
        lat: 41.88268842658458, lng: -87.62751922198979,    
        destination: "assets/black-dot.png",  
        note: "-",
        region: "north-america"
      },
           {
        name: "Indianapolis",
        lat: 39.7689786349564, lng: -86.15311289232605,    
        destination: "assets/black-dot.png",  
        note: "-",
        region: "north-america"
      },
        {
        name: "Cleveland",
        lat: 41.50273521152955, lng: -81.68986031536389,    
        destination: "assets/black-dot.png",  
        note: "-",
        region: "north-america"
      },
           {
        name: "Kansas City",
        lat: 39.10034294911827, lng: -94.5833309693297,    
        destination: "assets/black-dot.png",  
        note: "-",
        region: "north-america"
      },
           {
        name: "Denver",
        lat: 39.7403722248545, lng: -104.97767259664374,    
        destination: "assets/black-dot.png",  
        note: "-",
        region: "north-america"
      },
           {
        name: "Moab",
        lat: 38.57327876611761, lng: -109.55074386985126,    
        destination: "assets/black-dot.png",  
        note: "-",
        region: "north-america"
      },
         {
        name: "Yellowstone National Park",
        lat: 44.611411823368435, lng: -110.514530780498,    
        destination: "assets/black-dot.png",  
        note: "-",
        region: "north-america"
      },
           {
        name: "Miami",
        lat: 25.76323961340018, lng: -80.1922635683231,    
        destination: "assets/black-dot.png",  
        note: "-",
        region: "north-america"
      },
           {
        name: "Savannah",
        lat: 32.080776482381886, lng: -81.09070428371469,    
        destination: "assets/black-dot.png",  
        note: "-",
        region: "north-america"
      },
           {
        name: "Charleston",
        lat: 32.783630768755735, lng: -79.93041210581677,    
        destination: "assets/black-dot.png",  
        note: "-",
        region: "north-america"
      },
            {
        name: "Atlanta",
        lat: 33.74980983050412, lng: -84.3877520670381,    
        destination: "assets/black-dot.png",  
        note: "-",
        region: "north-america"
      },
            {
        name: "New Orleans",
        lat: 29.950974551233713, lng: -90.07527395509003,   
        destination: "assets/black-dot.png",  
        note: "-",
        region: "north-america"
      },
            {
        name: "Memphis",
        lat: 35.14814012845415, lng: -90.0504868932041,    
        destination: "assets/black-dot.png",  
        note: "-",
        region: "north-america"
      },
            {
        name: "Nashville",
        lat: 36.162542545391226, lng: -86.7822524630937,    
        destination: "assets/black-dot.png",  
        note: "-",
        region: "north-america"
      },
            {
        name: "Huntsville",
        lat: 34.73015580981167, lng: -86.58397780143977,    
        destination: "assets/black-dot.png",  
        note: "-",
        region: "north-america"
      },
         {
        name: "Houston",
        lat: 29.76656834960227, lng: -95.36236094159233,    
        destination: "assets/black-dot.png",  
        note: "-",
        region: "north-america"
      },
         {
        name: "Austin",
        lat: 30.271106994370317, lng: -97.73504184817182,    
        destination: "assets/black-dot.png",  
        note: "-",
        region: "north-america"
      },
         {
        name: "Santa Fe",
        lat: 35.68959519613997, lng:  -105.93721216032161,   
        destination: "assets/black-dot.png",  
        note: "-",
        region: "north-america"
      },
         {
        name: "Route 66",
        lat: 35.19212083604028, lng: -114.04847373827002,     
        destination: "assets/black-dot.png",  
        note: "-",
        region: "north-america"
      },
       {
        name: "Phoenix",
        lat: 33.44518313947133, lng: -112.07786658699041,    
        destination: "assets/black-dot.png",  
        note: "-",
        region: "north-america"
      },
       {
        name: "Sedona",
        lat: 34.86371195123784, lng: -111.81438583102138,    
        destination: "assets/black-dot.png",  
        note: "-",
        region: "north-america"
      },
       {
        name: "Grand Canyon",
        lat: 36.100802410513744, lng: -112.11205548994302,    
        destination: "assets/black-dot.png",  
        note: "-",
        region: "north-america"
      },
       {
        name: "Las Vegas",
        lat: 36.17149945007827, lng: -115.13872482571836,   
        destination: "assets/black-dot.png",  
        note: "-",
        region: "north-america"
      },
        {
        name: "Los Angeles",
        lat: 34.05465650605094, lng: -118.2561380681273,    
        destination: "assets/usa-flag.png",  
        note: "-",
        region: "north-america"
      },
        {
        name: "San Francisco",
        lat: 37.77784484651388, lng: -122.41282705873314,    
        destination: "assets/black-dot.png",  
        note: "-",
        region: "north-america"
      },
         {
        name: "Guadalajara",
        lat: 20.677010987331542, lng: -103.34752670709736,   
        destination: "assets/black-dot.png",  
        note: "-",
        region: "north-america"
      },
         {
        name: "Mexico City",
        lat: 19.432544560239055, lng: -99.13096556640932,   
        destination: "assets/black-dot.png",  
        note: "-",
        region: "north-america"
      },
         {
        name: "Oaxaca",
        lat: 17.07278435125949, lng: -96.72634456484178,  
        destination: "assets/black-dot.png",  
        note: "-",
        region: "north-america"
      },
         {
        name: "Merida",
        lat: 20.967716148485437, lng: -89.59273287275839,   
        destination: "assets/black-dot.png",  
        note: "-",
        region: "north-america"
      },
         {
        name: "Havana",
        lat: 23.13459246458203, lng: -82.35791906899723,   
        destination: "assets/black-dot.png",  
        note: "-",
        region: "north-america"
      },
         {
        name: "Vinales",
        lat: 22.618811297850826, lng: -83.70665053329138,   
        destination: "assets/black-dot.png",  
        note: "-",
        region: "north-america"
      },
         {
        name: "Kingston",
        lat: 18.0183056544133,  lng: -76.8089772023489,  
        destination: "assets/black-dot.png",  
        note: "-",
        region: "north-america"
      },
           {
        name: "Ocho Rios",
        lat: 18.4073695583668,  lng: -77.10310726492314,  
        destination: "assets/black-dot.png",  
        note: "-",
        region: "north-america"
      },
         {
        name: "Negril",
        lat: 18.278913566295927, lng:  -78.34370756164991,  
        destination: "assets/black-dot.png",  
        note: "-",
        region: "north-america"
      },
         {
        name: "Montego Bay",
        lat: 18.471831669696066, lng: -77.92041525946033,  
        destination: "assets/black-dot.png",  
        note: "-",
        region: "north-america"
      },
         {
        name: "San Jose",
        lat:  9.928248163622198, lng: -84.09028388072183,  
        destination: "assets/black-dot.png",  
        note: "-",
        region: "north-america"
      },

      // South America
         {
        name: "Bogota",
        lat: 4.711093897883025, lng: -74.0714359026008,  
        destination: "assets/black-dot.png",  
        note: "-",
        region: "south-america"
      },
         {
        name: "Medellin",
        lat: 6.247629211964346, lng: -75.56438625894688,  
        destination: "assets/black-dot.png",  
        note: "-",
        region: "south-america"
      },
         {
        name: "Quito",
        lat: -0.2232819603237502, lng: -78.5136979263753,  
        destination: "assets/black-dot.png",  
        note: "-",
        region: "south-america"
      },
         {
        name: "Santiago",
        lat: -33.45130231352738, lng: -70.6766724657009,  
        destination: "assets/black-dot.png",  
        note: "-",
        region: "south-america"
      },
         {
        name: "Lima",
        lat: -12.045936019259404, lng:  -77.04475828442126, 
        destination: "assets/black-dot.png",  
        note: "-",
        region: "south-america"
      },
         {
        name: "Cusco",
        lat: -13.531907393993903, lng: -71.96733800414252,  
        destination: "assets/black-dot.png",  
        note: "-",
        region: "south-america"
      },
             {
        name: "Sucre",
        lat: -19.035251140767482, lng: -65.26030793967227,   
        destination: "assets/black-dot.png",  
        note: "-",
        region: "south-america"
      },
             {
        name: "La Paz",
        lat: -16.494290618939463, lng: -68.12111919909478,  
        destination: "assets/black-dot.png",  
        note: "-",
        region: "south-america"
      },
         {
        name: "Rio de Janeiro",
        lat: -22.9070198031695, lng: -43.17328824523965,  
        destination: "assets/black-dot.png",  
        note: "-",
        region: "south-america"
      },
         {
        name: "Sao Paulo",
        lat: -23.555503217315778, lng: -46.63535076679225,  
        destination: "assets/black-dot.png",  
        note: "-",
        region: "south-america"
      },
         {
        name: "Salvador",
        lat: -12.977855380518672, lng: -38.50186684249251,  
        destination: "assets/black-dot.png",  
        note: "-",
        region: "south-america"
      },
         {
        name: "Manaus",
        lat: -3.119432526904342, lng: -60.022290304328386,  
        destination: "assets/black-dot.png",  
        note: "-",
        region: "south-america"
      },
         {
        name: "Buenos Aires",
        lat: -34.60096265053558, lng: -58.38427623057528,  
        destination: "assets/black-dot.png",  
        note: "-",
        region: "south-america"
      },
         {
        name: "Patagonia",
        lat: -50.33429494633946, lng: -72.16542956843975,  
        destination: "assets/black-dot.png",  
        note: "-",
        region: "south-america"
      },

      // Europe

      // Bergen, Gothenburg, Billund, Roskilde, Turku, Tampere, Derry, Belfast, Limerick, Isle of Skye, Outer Hebrides
      // Pas de Calais, Marseille, Burgundy, Strasbourg, Wolfsburg, Rhine Valley, Heidelberg, Ghent, Antwerp, Gdansk, Wroclaw
      // Lodz, Coimbra, Cordoba, Turin, Modena, Pisa, Sicily, Lucerne, Graz, Eger, Pamukkale, Izmir, Crete, Antalya, Trabzon
      // Parnu, Tartu, Sigulda, Siauliai, Kaunas, Donetsk, Minsk, Veliky Novgorod, Volgograd, Malta, Nicosia, Paphos
           {
        name: "Reykjavik",
        lat: 64.14709405288546, lng: -21.94067790838177, 
        destination: "assets/black-dot.png",  
        note: "-",
        region: "europe"
      },
         {
        name: "Copenhagen",
        lat: 55.676854151467786, lng: 12.580432292830622, 
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
         {
        name: "Stockholm",
        lat: 59.33187532601879, lng: 18.064524018132875,  
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
         {
        name: "Oslo",
        lat: 59.91386946136484, lng: 10.752263050710615,  
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
         {
        name: "Tallinn",
        lat: 59.43696134448128, lng: 24.75359472967316,   
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
         {
        name: "Helsinki",
        lat: 60.169886209818955, lng: 24.938506956243987,  
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
         {
        name: "Rovaniemi",
        lat: 66.50399462506353, lng: 25.727375199411455,   
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
         {
        name: "Riga",
        lat: 56.9678169002369, lng: 24.10550715762453,  
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
         {
        name: "Vilnius",
        lat: 54.68727825033513, lng: 25.278964588963454,   
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
         {
        name: "Warsaw",
        lat: 52.229837385379945, lng: 21.013155400849673, 
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
         {
        name: "Krakow",
        lat: 50.06471010338415,  lng: 19.94501598212411,  
        destination: "assets/poland-flag.png",
        note: "-",
        region: "europe"
      },
          {
        name: "Berlin",
        lat: 52.52015230261851,  lng: 13.40472495464267,  
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
          {
        name: "Dresden",
        lat: 51.050420008439275,  lng: 13.737185466428961,  
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
          {
        name: "Nuremburg",
        lat: 49.454344532422105,  lng: 11.074653808733487,   
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
          {
        name: "Munich",
        lat: 48.13515007527161,  lng: 11.582113298663685,   
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
          {
        name: "Cologne",
        lat: 50.93760687245601,  lng: 6.960286447380035,   
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
      {
        name: "The Romantic Road",
        lat: 49.359239026082584,  lng: 10.146048324458654,  
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
          {
        name: "The Black Forest",
        lat: 47.99931012062807,  lng: 7.843104291358877,  
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
          {
        name: "Stuttgart",
        lat: 48.77586339862911,  lng: 9.183066700353741,  
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
          {
        name: "Amsterdam",
        lat: 52.36769210020186,  lng: 4.90342956807473,  
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
          {
        name: "The Hague",
        lat: 52.0705306104099,  lng: 4.300647577134074,  
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
      {
        name: "Brussels",
        lat: 50.847811707920954,  lng: 4.356641749053609,  
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
          {
        name: "Bruges",
        lat: 51.20842016126747,  lng: 3.225031505055912,   
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
          {
        name: "Ypres",
        lat: 50.85774375829256,  lng: 2.8715042484899715,    
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
          {
        name: "Kent",
        lat: 51.38798592149252,  lng: 0.5068152865021401,  
        destination: "assets/england-flag.png",
        note: "-",
        region: "europe"
      },
          {
        name: "London",
        lat: 51.50737420589367,  lng: -0.1274675391548623,  
        destination: "assets/england-flag.png",
        note: "-",
        region: "europe"
      },
           {
        name: "Cambridge",
        lat: 52.195405725848715,  lng: 0.13118782657581468,   
        destination: "assets/england-flag.png",
        note: "-",
        region: "europe"
      },
           {
        name: "York",
        lat: 53.96143607420014,  lng: -1.073896473243887,   
        destination: "assets/england-flag.png",
        note: "-",
        region: "europe"
      },
           {
        name: "Birmingham",
        lat: 52.482522920211096,  lng: -1.8871140472229588,   
        destination: "assets/england-flag.png",
        note: "-",
        region: "europe"
      },
          {
        name: "Cornwall",
        lat: 50.26318556354491,  lng: -5.051119976967521,  
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
          {
        name: "Cotswolds",
        lat: 51.79066737441077,  lng: -1.959030249663092,   
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
            {
        name: "Liverpool",
        lat: 53.3995552129288,  lng: -2.9919151290257204,   
        destination: "assets/england-flag.png",
        note: "-",
        region: "europe"
      },

           {
        name: "Manchester",
        lat: 53.4807874264068,  lng: -2.242631762475635,    
        destination: "assets/england-flag.png",
        note: "-",
        region: "europe"
      },

         {
        name: "Newcastle upon Tyne",
        lat: 54.97816889476448,  lng: -1.6192130711390966,    
        destination: "assets/england-flag.png",
        note: "-",
        region: "europe"
      },
         {
        name: "Norwich",
        lat: 52.62852569309048,  lng: 1.2920834867214679,   
        destination: "assets/england-flag.png",
        note: "-",
        region: "europe"
      }, 
          {
        name: "Sheffield",
        lat: 53.38118101891275,  lng: -1.4707796216441675,    
        destination: "assets/england-flag.png",
        note: "-",
        region: "europe"
      }, 
      {
        name: "Bath",
        lat: 51.38201048972575,  lng: -2.3598822371271715,   
        destination: "assets/england-flag.png",
        note: "-",
        region: "europe"
      },
       {
        name: "Nottingham",
        lat: 52.95433379037081,  lng: -1.1540116456294196,    
        destination: "assets/england-flag.png",
        note: "-",
        region: "europe"
      },
        {
        name: "Stratford upon Avon",
        lat: 52.19385188517134,  lng: -1.716165905373178,   
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
          {
        name: "Blackpool",
        lat: 53.81660271714891,  lng: -3.0366370473438615,    
        destination: "assets/england-flag.png",
        note: "-",
        region: "europe"
      },
         {
        name: "Cardiff",
        lat: 51.48371637493049,  lng: -3.1680982278663974,     
        destination: "assets/wales-flag.png",
        note: "-",
        region: "europe"
      },
            {
        name: "Glasgow",
        lat: 55.86164769698071,  lng: -4.25806153603916,     
        destination: "assets/scotland-flag.png",
        note: "-",
        region: "europe"
      },
          {
        name: "Edinburgh",
        lat: 55.95325883585607,  lng: -3.188374500397275,    
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
          {
        name: "Scottish Highlands",
        lat: 57.27071118684419,  lng: -4.491824424257684,    
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
        {
        name: "Mayo",
        lat: 53.944509443188004,  lng: -8.950306440377075,   
        destination: "assets/ireland-flag.png",
        note: "-",
        region: "europe"
      },
          {
        name: "Galway",
        lat: 53.27400852952436,  lng: -9.051249879576808,   
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
          {
        name: "Dublin",
        lat: 53.35035230667644,   lng: -6.261570654846846,   
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
          {
        name: "Clare",
        lat:  53.01617120231845,  lng: -9.376488034917385,   
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
          {
        name: "Kerry",
        lat: 52.140880544924244,  lng: -10.266980672936224,   
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
          {
        name: "Cork",
        lat: 51.898777412116885,  lng: -8.475462716333837,    
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
            {
        name: "Normandy",
        lat: 49.02639381371219,   lng: -0.3697326266154875,    
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
            {
        name: "Loire Valley",
        lat: 47.386772141359685,  lng: 0.6890031823450209,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
            {
        name: "Champagne",
        lat: 49.25839361472694, lng: 4.031575031000748,    
        destination: "assets/black-dot.png",  
        note: "-",
        region: "europe"
      },
            {
        name: "Paris",
        lat: 48.85754857065964,  lng: 2.351095450719635,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
        {
        name: "Bordeaux",
        lat: 44.8415303873766,  lng:  -0.5813877132162164,    
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
        {
        name: "Lyon",
        lat:  45.764531696190446,  lng: 4.835179746610237,   
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
        {
        name: "Provence",
        lat: 43.53224241465617,  lng: 5.447647729782521,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
        {
        name: "French Riviera",
        lat: 43.490900611084136,  lng: 6.793765877236518,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
      {
        name: "Zurich",
        lat: 47.37720188312213,  lng: 8.540854776359472,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
      {
        name: "Bern",
        lat: 46.947906876886854,  lng:  7.449008433944463,    
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
      {
        name: "Lausanne",
        lat: 46.51988531765292,  lng:  6.63178833810393,    
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
      {
        name: "Geneva",
        lat: 46.20459779299723,  lng: 6.1434692385512,
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
      {
        name: "Innsbruck",
        lat: 47.26773065798142,  lng: 11.391160498755447,     
        destination: "assets/black-dot.png",    
        note: "-",
        region: "europe"
      },
      {
        name: "Salzburg",
        lat: 47.80146559489588,  lng: 13.04496781804285,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
      {
        name: "Vienna",
        lat: 48.20820087607286,  lng: 16.372051489142063,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
         {
        name: "Hallstatt",
        lat: 47.56132162182419, lng: 13.647363161751343,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
      {
        name: "Budapest",
        lat: 47.49670043112757,  lng: 19.036921385094285,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
       {
        name: "Prague",
        lat: 50.07529559169478,  lng: 14.43796598469235,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
         {
        name: "Cesky Krumlov",
        lat: 48.81278385152057,  lng: 14.317374361641804,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
         {
        name: "Karlovy Vary",
        lat: 50.23193160462951,  lng: 12.87159277886476,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
       {
        name: "Bratislava",
        lat: 48.14771028366622,  lng: 17.108819044864113,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
       {
        name: "Ljubljana",
        lat: 46.05694787715469,  lng: 14.505271244549682,    
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
          {
        name: "Sarajevo",
        lat: 43.85626674115869,  lng: 18.41308798019437,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
          {
        name: "Mostar",
        lat: 43.34378183454105,  lng: 17.80773036265623,      
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
       {
        name: "Zagreb",
        lat: 45.81506100906844,  lng: 15.98182332859979,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
       {
        name: "Split",
        lat: 43.51470354492875,  lng: 16.443583819893906,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
       {
        name: "Dubrovnik",
        lat: 42.650679244840276,  lng: 18.094383893378385,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
          {
        name: "Bucharest",
        lat: 44.42651877964872, lng: 26.108711286865084, 
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
        {
        name: "Transylvania",
        lat: 45.65305831498248, lng: 25.736030432352848, 
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
        {
        name: "Belgrade",
        lat: 44.81473845896609,  lng: 20.45953718262759,
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
          {
        name: "Lviv",
        lat: 49.84240270117403, lng: 24.029742732639285,
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
        {
        name: "Kyiv",
        lat: 50.446102816627544,  lng: 30.522381936032804,
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
        {
        name: "Odesa",
        lat: 46.48680823524833,  lng: 30.73031732215606,
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
        {
        name: "Rome",
        lat: 41.89768815086756, lng: 12.476936055158559,
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
          {
        name: "Bologna",
        lat: 44.49496560820093, lng: 11.340267944322584,  
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
          {
        name: "Tuscany",
        lat: 43.772361190082286, lng: 11.239249355989253,   
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
    {
        name: "Naples",
        lat: 40.84894725749906, lng: 14.272991819770132,  
        destination: "assets/italy-flag.png",
        note: "City break base for Amalfi/Pompeii.",
        region: "europe"
      },
      {
        name: "Milan",
        lat: 45.468509121636934, lng: 9.182456487176053,  
        destination: "assets/black-dot.png",
        note: "Fashion & lakes gateway.",
        region: "europe"
      },
        {
        name: "Lake Como",
        lat: 46.010461636720414, lng: 9.258370422860988,  
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
        {
        name: "Cinque Terre",
        lat: 44.14693730452264, lng: 9.646125336631743,  
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
        {
        name: "Amalfi Coast",
        lat: 40.63666057445816, lng: 14.60243262282775,   
        destination: "assets/italy-flag.png",
        note: "-",
        region: "europe"
      },
        {
        name: "Venice",
        lat: 45.44080421549296, lng: 12.317325210367073,  
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
          {
        name: "Athens",
        lat: 37.985824191533005, lng: 23.728725630749693,  
        destination: "assets/black-dot.png",  
        note: "-",
        region: "europe"
      },
          {
        name: "Mykonos",
        lat: 37.4458201103513,  lng: 25.326357225868886,  
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
          {
        name: "Santorini",
        lat: 36.416619151961775, lng: 25.432321334668732,   
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
          {
        name: "Rhodes",
        lat: 36.43713002447467,  lng: 28.218355279699313,  
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
            {
        name: "Tenerife",
        lat: 28.29327826635113, lng: -16.629586689107516,    
        destination: "assets/spain-flag.png",
        note: "-",
        region: "europe"
      },
         {
        name: "Seville",
        lat: 37.38886748702286, lng: -5.985099678517259,   
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
         {
        name: "Toledo",
        lat: 39.8636917531435, lng: -4.029775145026025,   
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
         {
        name: "Madrid",
        lat: 40.415448974473684, lng: -3.701855273322984,  
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
      {
        name: "Barcelona",
        lat: 41.38825990594541, lng: 2.1638757607500914,
        destination: "assets/black-dot.png",
        note: "Beach + architecture.",
        region: "europe"
      },
         {
        name: "San Sebastian",
        lat: 43.31804706519294, lng: -1.980072603131987,  
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
          {
        name: "Valencia",
        lat: 39.4748365711434, lng: -0.37112701705047646,   
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
          {
        name: "Granada",
        lat: 37.18244889952489, lng: -3.6024299116716727,
        destination: "assets/black-dot.png",  
        note: "-",
        region: "europe"
      },
            {
        name: "Ibiza",
        lat: 38.91521451167642, lng: 1.4279513994276378,    
        destination: "assets/black-dot.png",  
        note: "-",
        region: "europe"
      },
      {
        name: "Lisbon",
        lat: 38.723048843144994, lng: -9.140853723871166,  
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
        {
        name: "Porto",
        lat: 41.1583050409901, lng: -8.630365712766778,   
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
         {
        name: "Sintra",
        lat: 38.802329690843884, lng: -9.38164860384695,    
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
        {
        name: "Algarve",
        lat: 37.0167014704076,  lng: -7.9354679155059715,  
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
          {
        name: "Madeira",
        lat: 32.65106517114215, lng: -16.89610598550119,  
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
       {
        name: "Istanbul",
        lat: 41.008831294064244, lng: 28.984703163215887,  
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
       {
        name: "Cappadocia",
        lat: 38.6485294471911, lng: 34.850133350771664,  
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
      {
        name: "Sofia",
        lat: 42.699102152920766, lng: 23.322386765910494,   
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
       {
        name: "Saint Petersburg",
        lat: 59.934427728738875, lng: 30.347911942320994,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
       {
        name: "Moscow",
        lat: 55.75980497991659, lng: 37.613489679534126,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
       {
        name: "Kazan",
        lat: 55.79158767130585, lng: 49.125752153475034,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
       {
        name: "Nizhniy Novgorod",
        lat: 56.33863023023021, lng: 44.02407394794639,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
       {
        name: "Vladivostok",
        lat: 43.10766291186338, lng: 131.75664496518553,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
       {
        name: "Novosibirsk",
        lat: 54.9914425497611, lng: 82.87034985503675,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
       {
        name: "Samara",
        lat: 53.22063967045973, lng: 50.30563600562854,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },
       {
        name: "Yekaterinburg",
        lat: 56.844668410686566, lng: 60.649363398142995,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "europe"
      },

      // Africa

      // Casablanca, Chefchaouen, Oran, Algiers, Tunis, Aswan, Dakar, Kigali, Dae es Salaam, Antananarivo, Maputo, Gaborone, Victoria Falls

           {
        name: "Tangier",
        lat: 35.76519622921863, lng: -5.83103937197697,   
        destination: "assets/black-dot.png",
        note: "-",
        region: "africa"
      },
           {
        name: "Fez",
        lat: 34.02125274081572, lng: -5.0062043083969066,   
        destination: "assets/black-dot.png",
        note: "-",
        region: "africa"
      },
           {
        name: "Marrakesh",
        lat: 31.625240650856576, lng: -7.98622668742172,   
        destination: "assets/black-dot.png",
        note: "-",
        region: "africa"
      },
          {
        name: "Rabat",
        lat: 34.00887253019932, lng: -6.853794004072933,   
        destination: "assets/black-dot.png",
        note: "-",
        region: "africa"
      },
         {
        name: "Nairobi",
        lat: -1.2927133735799872, lng: 36.82294667348338,   
        destination: "assets/black-dot.png",
        note: "-",
        region: "africa"
      },
       {
        name: "Serengeti",
        lat: -1.9315360415877365, lng: 34.713923669409745,   
        destination: "assets/black-dot.png",
        note: "-",
        region: "africa"
      },

       {
        name: "Zanzibar",
        lat: -6.165611978690259, lng: 39.205606782775384,   
        destination: "assets/black-dot.png",
        note: "-",
        region: "africa"
      },
       {
        name: "Addis Ababa",
        lat: 9.021420718978447, lng: 38.75764725727833,   
        destination: "assets/black-dot.png",
        note: "-",
        region: "africa"
      },
       {
        name: "Johannesburg",
        lat: -26.205817768123712, lng: 28.033246357057312,   
        destination: "assets/black-dot.png",
        note: "-",
        region: "africa"
      },
       {
        name: "Cape Town",
        lat: -33.9222519945119, lng: 18.426083283090602,   
        destination: "assets/black-dot.png",
        note: "-",
        region: "africa"
      },
      {
        name: "Cairo",
        lat: 30.04685244060589, lng: 31.236490953674103,    
        destination: "assets/black-dot.png",
        note: "-",
        region: "africa"
      },
      {
        name: "Luxor",
        lat: 25.687385576610335, lng: 32.6397970280669,    
        destination: "assets/black-dot.png",
        note: "-",
        region: "africa"
      },  

// Asia 

// Beirut, Tehran, Mashhad, Baku, Almaty, Astana, Bishkek, Tashkent, Samarkand, Bukhara, Ashgabat, Dushanbe, Islamabad, Lahore, Karachi
// Amritsar, Bangalore, Lhasa, Chongqing, Guangzhou, Nikko, Hakone, Chiang Rai, Sukhothai, Kanchanaburi, Sa Pa, Ho Chi Minh City
// Penang, Banda Aceh, Medan, Banaue, Cebu, Kandy, Langkawi

{
        name: "Tel Aviv",
        lat: 32.08428882890555,  lng: 34.78059411990009,    
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },

      {
        name: "Jerusalem",
        lat: 31.776548431123597, lng: 35.22375920797924,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
         {
        name: "Nazareth",
        lat: 32.69962007778769, lng: 35.30378994793834,      
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
         {
        name: "Bethlehem",
        lat: 31.70546805465603, lng: 35.202443641312925,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Doha",
        lat: 25.292374400028212, lng: 51.53674347744931,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Dubai",
        lat: 25.207730855832907, lng: 55.271777216689955,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Abu Dhabi",
        lat: 24.45884264645748, lng: 54.37884316312715,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Amman",
        lat: 31.963869136227153, lng: 35.91315978587027,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Petra",
        lat: 30.324071582180242, lng: 35.480108064581735,    
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Wadi Rum",
        lat: 29.572965142387975, lng: 35.421470700401095,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
      {
        name: "Muscat",
        lat: 23.58998938943278, lng: 58.3841813900166,      
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
      {
        name: "Kuwait City",
        lat: 29.378502985332236, lng: 47.974887416666895,      
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Riyadh",
        lat: 24.715895294828403, lng: 46.67566322133952,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Jeddah",
        lat: 21.53156143617193, lng: 39.16117332713833,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Beijing",
        lat: 39.904708948207066, lng: 116.40629378666631,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Xian",
        lat: 34.26753153354574, lng: 108.95453479024569,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
      // {
     //   name: "Pyongyang",
     //   lat: 39.03976450173026, lng: 125.76275374068145,     
     //   destination: "assets/black-dot.png",
      //  note: "-",
      //  region: "asia"
    //  },
       {
        name: "Hong Kong",
        lat:  22.32159648361065, lng: 114.1727908314567,    
        destination: "assets/china-flag.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Shenzhen",
        lat: 22.542565658160562, lng: 114.06266507893243,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Guilin",
        lat: 25.271175781713136, lng: 110.30209035294487,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Chengdu",
        lat: 30.572395054678324, lng: 104.0674766603587,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Shanghai",
        lat: 31.231548282892074, lng: 121.47375440409512,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Hangzhou",
        lat: 30.273474823912203, lng: 120.15454624495673,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
        {
        name: "Suzhou",
        lat: 31.298654766475444, lng: 120.58309739339623,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
        {
        name: "Yangshuo",
        lat: 24.77720779069028, lng: 110.49528760296474,      
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Ulaanbaatar",
        lat: 47.922340586775356, lng: 106.91623272436372,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Hanoi",
        lat: 21.02729979127629, lng: 105.83355947408955,     
        destination: "assets/vietnam-flag.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Ha Long Bay",
        lat: 20.971364767234384, lng:  107.04472913915995,    
        destination: "assets/vietnam-flag.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Hue",
        lat: 16.463400248681836, lng: 107.59028389695361,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Hoi An",
        lat: 15.880126911948263, lng: 108.3260499283607,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Vientiane",
        lat: 17.98009849914131, lng: 102.62848284748861,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Luang Prabang",
        lat: 19.88343247553513, lng: 102.13861060749099,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Yangon",
        lat: 16.84962869947336, lng: 96.17915465792554,      
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Mandalay",
        lat: 21.96076870912247, lng: 96.09017333791078,      
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Bagan",
        lat: 21.171783223328887, lng: 94.85861193643267,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Manila",
        lat: 14.599518801255039, lng: 120.9853587783262,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Boracay",
        lat: 11.967544811082488, lng: 121.924502332347,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Palawan",
        lat: 9.44180340554734, lng: 118.39350352286588,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Phnom Penh",
        lat: 11.557457618823975, lng: 104.9284773437748,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
         {
        name: "Sihanoukville",
        lat: 10.658582426769515,  lng: 103.26745258802944,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
         {
        name: "Siem Reap",
        lat: 13.363402361705312, lng: 103.85664038143845,      
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Bangkok",
        lat: 13.757196289320774, lng: 100.50180904895753,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Chiang Mai",
        lat: 18.789041587241105, lng: 98.98688984278627,    
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Phuket",
        lat: 7.985784278175289, lng: 98.33112686382262,     
        destination: "assets/thailand-flag.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Jakarta",
        lat: -6.187357070671649, lng: 106.85413102385716,    
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Yogyakarta",
        lat: -7.801414654548781, lng: 110.36580328892495,    
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Borneo",
        lat: -0.25078218449481476, lng: 114.21965753241345,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Bali",
        lat: -8.40778769353757,  lng: 115.18413395274675,    
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Kuala Lumpur",
        lat: 3.149925859843929, lng: 101.69283219800404,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Singapore",
        lat: 1.2809496197123105, lng: 103.85011777392548,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Taipei",
        lat: 25.034374188812905, lng: 121.56692858749368,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Seoul",
        lat: 37.55395545384301, lng: 126.9936361370215,      
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Gyeongju",
        lat: 35.82195665684188, lng: 129.2650109125429,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Busan",
        lat: 35.164763969341344, lng: 129.05181443860144,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Delhi",
        lat: 28.68555588857057, lng: 77.22848852846143,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
           {
        name: "Agra",
        lat: 27.177560663830192, lng: 78.00784831692503,      
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Jaipur",
        lat: 26.914579627509745, lng: 75.79295806709231,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Jodhpur",
        lat: 26.24262492174262, lng: 73.02951022538846,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Mumbai",
        lat: 18.959501056711073, lng: 72.83288671970709,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Varanasi",
        lat: 25.318894877020533, lng: 82.9730837377627,    
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Chennai",
        lat: 13.085513669421807, lng: 80.27047989785116,    
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
         {
        name: "Udaipur",
        lat: 24.585578952802333, lng: 73.71250040486585,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Colombo",
        lat: 6.925926707030244, lng: 79.86204116414342,    
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Kathmandu",
        lat: 27.71229766152192, lng: 85.32235549565038,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Tokyo",
        lat: 35.68167621444384, lng: 139.7694776560827,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Nagoya",
        lat: 35.181748602682376, lng: 136.9072767815572,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Sapporo",
        lat: 43.06294133982934, lng: 141.35432679202515,    
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Kanazawa",
        lat: 36.581808011899284, lng: 136.56526033926303,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Hiroshima",
        lat: 34.39953198434529, lng: 132.45103637973926,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Osaka",
        lat: 34.695470570371114, lng: 135.50171588088833,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Nara",
        lat: 34.70280310803936, lng: 135.82606246414989,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Kyoto",
        lat: 35.01239320606751, lng: 135.76739059848708,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },
       {
        name: "Okayama",
        lat: 34.65820269705041, lng: 133.91912330122736,    
        destination: "assets/black-dot.png",
        note: "-",
        region: "asia"
      },

// Oceania 

// Fiji, Tonga, Tahiti, Uluru, Wellington

 {
        name: "Melbourne",
        lat: -37.804115012656496, lng: 144.95009983596563,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "oceania"
      },
       {
        name: "Brisbane",
        lat: -27.471493931577516, lng: 153.01409227438853,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "oceania"
      },
       {
        name: "Sydney",
        lat:  -33.87234939702612, lng: 151.20637468765491,    
        destination: "assets/black-dot.png",
        note: "-",
        region: "oceania"
      },
       {
        name: "Canberra",
        lat: -35.27830446247856, lng: 149.13083083876302,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "oceania"
      },
       {
        name: "Tasmania",
        lat: -41.88770097039727, lng: 146.46066215547248,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "oceania"
      },
       {
        name: "Auckland",
        lat: -36.8504369916508, lng: 174.7592070221226,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "oceania"
      },
       {
        name: "Rotorua",
        lat:  -38.144253336442446, lng: 176.23598615409264,    
        destination: "assets/black-dot.png",
        note: "-",
        region: "oceania"
      },
       {
        name: "Queenstown",
        lat: -45.03020847165292, lng: 168.6612610095522,     
        destination: "assets/black-dot.png",
        note: "-",
        region: "oceania"
      },
       {
        name: "Bora Bora",
        lat:  -16.50599688653384, lng: -151.74218231492173,    
        destination: "assets/black-dot.png",
        note: "-",
        region: "oceania"
      },

    ];

      // POPUP HTML
    function buildPopup(d) {
      const plan = loadPlanLocal(d.name);
      const days = Math.max(1, Number(plan.days || 1));
      const nightsDefault = Math.max(1, Number(plan.hotel?.nights ?? Math.max(1, days - 1)));

      const dayOptions = Array.from({ length: days }, (_, i) => `<option value="${i + 1}">Day ${i + 1}</option>`).join("");
      const currencies = ["GBP","EUR","USD","CAD","AUD","NZD","JPY","CNY"];
      const currencyOptions = currencies.map(
        c => `<option value="${c}" ${(plan.hotel?.currency || "GBP") === c ? "selected" : ""}>${c}</option>`
      ).join("");

      return `
        <div class="popup" data-dest="${encodeURIComponent(d.name)}">
          <div class="header">
            ${d.destination ? `<img src="${d.destination}" alt="${d.name} icon" />` : ""}
            <div class="title">
              <h3 style="margin:0 0 4px;">${d.name}</h3>
              ${d.note ? `<p style="margin:0 0 4px;">${d.note}</p>` : ""}
              <p style="margin:6px 0 0;">
                <a href="https://maps.google.com/?q=${d.lat},${d.lng}" target="_blank" rel="noopener">Open in Google Maps</a>
              </p>
              <div class="loading-hint" id="cloud-hint">If signed in, your latest data loads from Firebase when this popup opens.</div>
            </div>
          </div>

          <div class="tabs">
            <button class="tab-btn active" data-tab="tab-days">Days</button>
            <button class="tab-btn" data-tab="tab-daily">Daily Plan</button>
            <button class="tab-btn" data-tab="tab-stay">Stay & Budget</button>
            <button class="tab-btn" data-tab="tab-flights">Flights</button>
            <button class="tab-btn" data-tab="tab-food">Food</button>
            <button class="tab-btn" data-tab="tab-notes">Notes</button>
            <button class="tab-btn" data-tab="tab-tips">Tips</button>
            <span class="saved-toast" aria-live="polite">Saved</span>
          </div>

          <div id="tab-days" class="tab-panel active">
            <div class="row">
              <label for="days-input">Number of days:</label>
              <input id="days-input" type="number" min="1" step="1" value="${days}">
              <button class="btn primary" id="apply-days">Apply</button>
            </div>
            <p class="hint">Set how long you‚Äôll stay. This also influences default nights for hotel total (editable).</p>
          </div>

          <div id="tab-daily" class="tab-panel">
            <div class="day-nav">
              <button class="btn ghost" id="prev-day" title="Previous day">&#9664;</button>
              <label for="day-select" style="min-width:auto;">Go to:</label>
              <select id="day-select">${dayOptions}</select>
              <button class="btn ghost" id="next-day" title="Next day">&#9654;</button>
            </div>
            <div id="day-label" style="font-weight:600;margin-bottom:6px;color:#333;"></div>

            <textarea id="day-activities"
              rows="8"
              style="width:100%; font-family: Arial, system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; font-size:14px;"></textarea>

            <div class="save-bar">
              <button class="btn primary" id="save-day">Save Day</button>
              <button class="btn" id="clear-day">Clear Day</button>
            </div>
          </div>

          <div id="tab-stay" class="tab-panel">
            <div class="tabs budget-subtabs">
              <button class="tab-btn" data-btab="tab-cheap">Cheap option</button>
              <button class="tab-btn active" data-btab="tab-medium">Medium option (main hotel)</button>
              <button class="tab-btn" data-btab="tab-luxury">Luxury option</button>
            </div>

            <div id="tab-medium" class="tab-panel active">
              <h4>Main Hotel</h4>
              <div class="row">
                <label for="hotel-name">Hotel name (optional):</label>
                <input id="hotel-name" type="text" value="${(plan.hotel?.name||"").replace(/"/g,'&quot;')}" placeholder="e.g., Hotel Central">
              </div>
              <div class="row">
                <label for="currency">Currency:</label>
                <select id="currency">${currencyOptions}</select>
              </div>
              <div class="row">
                <label for="nightly">Avg price per night:</label>
                <input id="nightly" type="number" min="0" step="1" value="${plan.hotel?.nightly||""}">
              </div>
              <div class="row">
                <label for="nights">Nights:</label>
                <input id="nights" type="number" min="1" step="1" value="${nightsDefault}">
              </div>
              <div class="row">
                <label>Total (auto):</label>
                <div id="hotel-total" aria-live="polite" style="font-weight:600;">‚Äî</div>
              </div>
              <textarea id="hotel-notes" class="textarea" placeholder="Notes (optional)">${(plan.hotel?.notes||"").replace(/</g,"&lt;")}</textarea>
              <div class="save-bar">
                <button class="btn primary" id="save-hotel">Save Stay</button>
                <button class="btn" id="clear-hotel">Clear</button>
              </div>
            </div>

            <div id="tab-cheap" class="tab-panel">
              <h4>Cheap option</h4>
              <div class="row"><label>Name:</label><input id="cheap-name" type="text"></div>
              <div class="row"><label>Currency:</label><select id="cheap-currency">${currencyOptions}</select></div>
              <div class="row"><label>Price per night:</label><input id="cheap-price" type="number" min="0" step="1"></div>
              <div class="row"><label>Nights:</label><input id="cheap-nights" type="number" min="1" step="1"></div>
              <div class="row"><label>Total:</label><div id="cheap-total" style="font-weight:600;">‚Äî</div></div>
              <textarea id="cheap-notes" class="textarea" placeholder="Notes (optional)"></textarea>
            </div>

            <div id="tab-luxury" class="tab-panel">
              <h4>Luxury option</h4>
              <div class="row"><label>Name:</label><input id="luxury-name" type="text"></div>
              <div class="row"><label>Currency:</label><select id="luxury-currency">${currencyOptions}</select></div>
              <div class="row"><label>Price per night:</label><input id="luxury-price" type="number" min="0" step="1"></div>
              <div class="row"><label>Nights:</label><input id="luxury-nights" type="number" min="1" step="1"></div>
              <div class="row"><label>Total:</label><div id="luxury-total" style="font-weight:600;">‚Äî</div></div>
              <textarea id="luxury-notes" class="textarea" placeholder="Notes (optional)"></textarea>
            </div>

            <div class="save-bar">
              <button class="btn primary" id="save-budget">Save Hotel Options</button>
            </div>
          </div>

          <div id="tab-flights" class="tab-panel">
  <h4>Flights</h4>

  <div class="row">
    <label>Out date:</label>
    <input id="flight-out-date" type="text" placeholder="e.g., 27/02/2026">
  </div>
  <div class="row">
    <label>Out time:</label>
    <input id="flight-out-time" type="text" placeholder="e.g., 22:05">
  </div>

  <div class="row">
    <label>Return date:</label>
    <input id="flight-ret-date" type="text" placeholder="e.g., 07/03/2026">
  </div>
  <div class="row">
    <label>Return time:</label>
    <input id="flight-ret-time" type="text" placeholder="e.g., 19:30">
  </div>

  <div class="row">
    <label>Operator:</label>
    <input id="flight-operator" type="text" placeholder="e.g., Cathay Pacific">
  </div>
  <div class="row">
    <label>Flight code:</label>
    <input id="flight-code" type="text" placeholder="e.g., CX254">
  </div>

  <div class="row">
    <label>Journey time (out):</label>
    <input id="journey-out" type="text" placeholder="e.g., 13h 45m">
  </div>
  <div class="row">
    <label>Journey time (return):</label>
    <input id="journey-ret" type="text" placeholder="e.g., 12h 55m">
  </div>
  <div class="row">
    <label>Layover duration:</label>
    <input id="layover-duration" type="text" placeholder="e.g., 2h 10m">
  </div>

  <textarea id="flight-notes" class="textarea" placeholder="Notes (optional)"></textarea>

  <div class="save-bar">
    <button class="btn primary" id="save-flights">Save Flights</button>
    <button class="btn" id="clear-flights">Clear</button>
  </div>

  <p class="hint">Tip: ‚ÄúJourney time‚Äù is total travel time. ‚ÄúLayover duration‚Äù is time between flights (if applicable).</p>
</div>


          <div id="tab-food" class="tab-panel">
            <div class="day-nav">
              <label for="food-day-select">Day:</label>
              <select id="food-day-select"></select>
            </div>

            <div class="tabs food-subtabs">
              <button class="tab-btn active" data-subtab="tab-breakfast">Breakfast</button>
              <button class="tab-btn" data-subtab="tab-lunch">Lunch</button>
              <button class="tab-btn" data-subtab="tab-dinner">Dinner</button>
            </div>

            <div id="tab-breakfast" class="tab-panel active">
              <div class="row"><label>Dish:</label><input id="breakfast-dish" type="text"><input id="breakfast-dish-desc" type="text" placeholder="Description"></div>
              <div class="row"><label>Hot drink:</label><input id="breakfast-hot" type="text"><input id="breakfast-hot-desc" type="text" placeholder="Description"></div>
              <div class="row"><label>Cold drink:</label><input id="breakfast-cold" type="text"><input id="breakfast-cold-desc" type="text" placeholder="Description"></div>
            </div>

            <div id="tab-lunch" class="tab-panel">
              <div class="row"><label>Dish:</label><input id="lunch-dish" type="text"><input id="lunch-dish-desc" type="text" placeholder="Description"></div>
              <div class="row"><label>Hot drink:</label><input id="lunch-hot" type="text"><input id="lunch-hot-desc" type="text" placeholder="Description"></div>
              <div class="row"><label>Cold drink:</label><input id="lunch-cold" type="text"><input id="lunch-cold-desc" type="text" placeholder="Description"></div>
            </div>

            <div id="tab-dinner" class="tab-panel">
              <div class="row"><label>Starter:</label><input id="dinner-starter" type="text"><input id="dinner-starter-desc" type="text" placeholder="Description"></div>
              <div class="row"><label>Main course:</label><input id="dinner-main" type="text"><input id="dinner-main-desc" type="text" placeholder="Description"></div>
              <div class="row"><label>Dessert:</label><input id="dinner-dessert" type="text"><input id="dinner-dessert-desc" type="text" placeholder="Description"></div>
              <div class="row"><label>Alcoholic drink:</label><input id="dinner-alcohol" type="text"><input id="dinner-alcohol-desc" type="text" placeholder="Description"></div>
              <div class="row"><label>Cold drink:</label><input id="dinner-cold" type="text"><input id="dinner-cold-desc" type="text" placeholder="Description"></div>
            </div>

            <div class="save-bar">
              <button class="btn primary" id="save-food">Save Food Diary</button>
              <button class="btn" id="clear-food">Clear</button>
            </div>

            <p class="hint">Food diary is saved per destination and includes breakfast, lunch, and dinner entries per day.</p>
          </div>

          <div id="tab-notes" class="tab-panel">
            <textarea id="notes-text" class="textarea" placeholder="Anything else to remember..."></textarea>
            <div class="save-bar">
              <button class="btn primary" id="save-notes">Save Notes</button>
              <button class="btn" id="clear-notes">Clear</button>
            </div>
          </div>

          <div id="tab-tips" class="tab-panel">
            <textarea id="tips-text" class="textarea" placeholder="Write any travel tips..."></textarea>
            <div class="save-bar">
              <button class="btn primary" id="save-tips">Save Tips</button>
              <button class="btn" id="clear-tips">Clear</button>
            </div>
          </div>
        </div>`;
    }

    // -------------------------
    // POPUP HANDLERS (async)
    // -------------------------
    async function initPopupHandlers(container, d){
      const name = d.name;
      const toast = container.querySelector('.saved-toast');

      let plan = loadPlanLocal(name);

      const hint = container.querySelector("#cloud-hint");
      if (hint) hint.textContent = "Loading latest data‚Ä¶";
      const loaded = await loadPlanFromFirebaseIfSignedIn(name);
      plan = loaded.plan;
      if (hint) hint.textContent = loaded.from === "firebase"
        ? "‚úÖ Loaded latest from Firebase."
        : "Loaded from local cache (sign in to sync).";

      function showSaved(){
        if (!toast) return;
        toast.classList.add('show');
        setTimeout(()=>toast.classList.remove('show'), 1200);
      }

      // Budget subtabs
      const budgetBtns = container.querySelectorAll('.budget-subtabs .tab-btn[data-btab]');
      const budgetPanels = ['tab-cheap','tab-medium','tab-luxury'];
      function activateBudgetTab(id){
        budgetBtns.forEach(b => b.classList.remove('active'));
        container.querySelector(`.budget-subtabs .tab-btn[data-btab="${id}"]`)?.classList.add('active');
        budgetPanels.forEach(pid => container.querySelector('#'+pid)?.classList.remove('active'));
        container.querySelector('#'+id)?.classList.add('active');
      }
      budgetBtns.forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.preventDefault();
          e.stopPropagation();
          activateBudgetTab(btn.dataset.btab);
        }, { passive: false });
      });
      activateBudgetTab('tab-medium');

      // Main tabs
      const mainTabBtns = container.querySelectorAll('.tab-btn[data-tab]');
      mainTabBtns.forEach(btn=>{
        btn.addEventListener('click', ()=>{
          mainTabBtns.forEach(b=>b.classList.remove('active'));
          container.querySelectorAll(':scope > .tab-panel').forEach(p=>p.classList.remove('active'));
          btn.classList.add('active');
          const panel = container.querySelector('#'+btn.dataset.tab);
          if (panel) panel.classList.add('active');
        });
      });

      const daysInput = container.querySelector('#days-input');
      const applyDaysBtn = container.querySelector('#apply-days');

      const rebuildDaySelector = ()=>{
        const daySelect = container.querySelector('#day-select');
        if (!daySelect) return;
        const newDays = Math.max(1, Number(daysInput.value||1));
        for (let i=1; i<=newDays; i++){
          if (!(i in plan.activities)) plan.activities[i] = "";
          if (!plan.food[i]) plan.food[i] = makeEmptyPlan(newDays).food[i];
        }
        Object.keys(plan.activities).map(k=>+k).filter(k=>k>newDays).forEach(k=>delete plan.activities[k]);
        Object.keys(plan.food).map(k=>+k).filter(k=>k>newDays).forEach(k=>delete plan.food[k]);
        daySelect.innerHTML = Array.from({length:newDays},(_,i)=>`<option value="${i+1}">Day ${i+1}</option>`).join("");
      };

      async function persistPlan(){
        savePlanLocal(name, plan);
        await savePlanToFirebaseIfSignedIn(name, plan);
      }

      applyDaysBtn?.addEventListener('click', async ()=>{
        plan.days = Math.max(1, Number(daysInput.value||1));
        rebuildDaySelector();
        await persistPlan();
        showSaved();
      });

      // Daily plan
      const daySelect = container.querySelector('#day-select');
      const dayArea = container.querySelector('#day-activities');
      const dayLabel = container.querySelector('#day-label');
      const prevBtn = container.querySelector('#prev-day');
      const nextBtn = container.querySelector('#next-day');

      let currentDay = Number(daySelect?.value || 1);

      function loadDayText(day = currentDay){
        if (!dayArea) return;
        dayArea.value = plan.activities[day] ?? "";
        if (dayLabel) dayLabel.textContent = `üìÖ Day ${day} Plan`;
      }

      async function saveDayText(day = currentDay){
        if (!dayArea) return;
        plan.activities[day] = dayArea.value;
        await persistPlan();
        showSaved();
      }

      daySelect?.addEventListener('change', async () => {
        const newDay = Number(daySelect.value || 1);
        if (newDay === currentDay) return;
        await saveDayText(currentDay);
        currentDay = newDay;
        loadDayText(currentDay);
      });

      prevBtn?.addEventListener('click', async () => {
        if (!daySelect) return;
        if (currentDay > 1) {
          await saveDayText(currentDay);
          currentDay -= 1;
          daySelect.value = String(currentDay);
          loadDayText(currentDay);
        }
      });

      nextBtn?.addEventListener('click', async () => {
        if (!daySelect) return;
        if (currentDay < plan.days) {
          await saveDayText(currentDay);
          currentDay += 1;
          daySelect.value = String(currentDay);
          loadDayText(currentDay);
        }
      });

      container.querySelector('#save-day')?.addEventListener('click', async () => saveDayText(currentDay));
      container.querySelector('#clear-day')?.addEventListener('click', async () => { if(dayArea){ dayArea.value=""; } await saveDayText(currentDay); });

      // Stay & budget (medium)
      const hotelName = container.querySelector('#hotel-name');
      const currency = container.querySelector('#currency');
      const nightly = container.querySelector('#nightly');
      const nights = container.querySelector('#nights');
      const total = container.querySelector('#hotel-total');
      const hotelNotes = container.querySelector('#hotel-notes');

      if (hotelName) hotelName.value = plan.hotel?.name || "";
      if (currency) currency.value = plan.hotel?.currency || "GBP";
      if (nightly) nightly.value = plan.hotel?.nightly || "";
      if (nights)  nights.value  = Math.max(1, Number(plan.hotel?.nights || Math.max(1, (plan.days || 1) - 1)));
      if (hotelNotes) hotelNotes.value = plan.hotel?.notes || "";

      const renderTotal = ()=>{
        const n = Number(nightly?.value||0);
        const k = Math.max(1, Number(nights?.value||1));
        const curr = currency?.value || "GBP";
        if (total) total.textContent = (n>0 && k>0) ? `${curr} ${(n*k).toLocaleString(undefined,{maximumFractionDigits:0})}` : "‚Äî";
      };
      nightly?.addEventListener('input', renderTotal);
      nights?.addEventListener('input', renderTotal);
      currency?.addEventListener('change', renderTotal);
      renderTotal();

      async function saveHotel(){
        plan.hotel.name = hotelName?.value || "";
        plan.hotel.currency = currency?.value || "GBP";
        plan.hotel.nightly = nightly?.value || "";
        plan.hotel.nights = Math.max(1, Number(nights?.value||1));
        plan.hotel.notes = hotelNotes?.value || "";
        await persistPlan();
        showSaved();
      }

      container.querySelector('#save-hotel')?.addEventListener('click', saveHotel);
      container.querySelector('#clear-hotel')?.addEventListener('click', async ()=>{
        if (hotelName) hotelName.value="";
        if (currency) currency.value="GBP";
        if (nightly) nightly.value="";
        if (nights) nights.value=Math.max(1, (plan.days|0)-1 || 1);
        if (hotelNotes) hotelNotes.value="";
        await saveHotel();
        renderTotal();
      });

      // Budget fields
      const cheapName = container.querySelector('#cheap-name');
      const cheapCurrency = container.querySelector('#cheap-currency');
      const cheapPrice = container.querySelector('#cheap-price');
      const cheapNights = container.querySelector('#cheap-nights');
      const cheapTotal = container.querySelector('#cheap-total');
      const cheapNotes = container.querySelector('#cheap-notes');

      const luxuryName = container.querySelector('#luxury-name');
      const luxuryCurrency = container.querySelector('#luxury-currency');
      const luxuryPrice = container.querySelector('#luxury-price');
      const luxuryNights = container.querySelector('#luxury-nights');
      const luxuryTotal = container.querySelector('#luxury-total');
      const luxuryNotes = container.querySelector('#luxury-notes');

      if (!plan.budget) plan.budget = makeEmptyPlan(plan.days).budget;
      if (!plan.budget.cheap) plan.budget.cheap = makeEmptyPlan(plan.days).budget.cheap;
      if (!plan.budget.luxury) plan.budget.luxury = makeEmptyPlan(plan.days).budget.luxury;

      function renderBudgetTotals() {
        if (cheapTotal) {
          const p = Number(cheapPrice?.value || 0);
          const n = Math.max(1, Number(cheapNights?.value || 1));
          const c = cheapCurrency?.value || "GBP";
          cheapTotal.textContent = (p > 0) ? `${c} ${(p*n).toLocaleString(undefined,{maximumFractionDigits:0})}` : "‚Äî";
        }
        if (luxuryTotal) {
          const p = Number(luxuryPrice?.value || 0);
          const n = Math.max(1, Number(luxuryNights?.value || 1));
          const c = luxuryCurrency?.value || "GBP";
          luxuryTotal.textContent = (p > 0) ? `${c} ${(p*n).toLocaleString(undefined,{maximumFractionDigits:0})}` : "‚Äî";
        }
      }

      function loadBudgetFields() {
        if (cheapName) cheapName.value = plan.budget.cheap?.name || "";
        if (cheapCurrency) cheapCurrency.value = plan.budget.cheap?.currency || "GBP";
        if (cheapPrice) cheapPrice.value = plan.budget.cheap?.price || "";
        if (cheapNights) cheapNights.value = plan.budget.cheap?.nights || Math.max(1, (plan.days|0)-1 || 1);
        if (cheapNotes) cheapNotes.value = plan.budget.cheap?.notes || "";

        if (luxuryName) luxuryName.value = plan.budget.luxury?.name || "";
        if (luxuryCurrency) luxuryCurrency.value = plan.budget.luxury?.currency || "GBP";
        if (luxuryPrice) luxuryPrice.value = plan.budget.luxury?.price || "";
        if (luxuryNights) luxuryNights.value = plan.budget.luxury?.nights || Math.max(1, (plan.days|0)-1 || 1);
        if (luxuryNotes) luxuryNotes.value = plan.budget.luxury?.notes || "";

        renderBudgetTotals();
      }

      async function saveBudgetFields() {
        plan.budget.cheap = {
          name: cheapName?.value || "",
          currency: cheapCurrency?.value || "GBP",
          price: cheapPrice?.value || "",
          nights: cheapNights?.value || "",
          notes: cheapNotes?.value || ""
        };
        plan.budget.luxury = {
          name: luxuryName?.value || "",
          currency: luxuryCurrency?.value || "GBP",
          price: luxuryPrice?.value || "",
          nights: luxuryNights?.value || "",
          notes: luxuryNotes?.value || ""
        };
        await persistPlan();
        showSaved();
      }

      [cheapPrice, cheapNights, cheapCurrency, luxuryPrice, luxuryNights, luxuryCurrency].forEach(el => {
        el?.addEventListener('input', renderBudgetTotals);
        el?.addEventListener('change', renderBudgetTotals);
      });

      loadBudgetFields();
      container.querySelector('#save-budget')?.addEventListener('click', saveBudgetFields);

      // -------------------------
// Flights
// -------------------------
const fOutDate = container.querySelector("#flight-out-date");
const fOutTime = container.querySelector("#flight-out-time");
const fRetDate = container.querySelector("#flight-ret-date");
const fRetTime = container.querySelector("#flight-ret-time");
const fOperator = container.querySelector("#flight-operator");
const fCode = container.querySelector("#flight-code");

const jOut = container.querySelector("#journey-out");
const jRet = container.querySelector("#journey-ret");
const layoverDur = container.querySelector("#layover-duration");
const fNotes = container.querySelector("#flight-notes");

function loadFlightsUI(){
  const fl = plan.flights || {};
  const j = fl.journey || {};

  if (fOutDate) fOutDate.value = fl.out?.date || "";
  if (fOutTime) fOutTime.value = fl.out?.time || "";
  if (fRetDate) fRetDate.value = fl.ret?.date || "";
  if (fRetTime) fRetTime.value = fl.ret?.time || "";

  if (fOperator) fOperator.value = fl.operator || "";
  if (fCode) fCode.value = fl.flightCode || "";

  if (jOut) jOut.value = j.outDuration || "";
  if (jRet) jRet.value = j.returnDuration || "";
  if (layoverDur) layoverDur.value = fl.layoverDuration || "";

  if (fNotes) fNotes.value = fl.notes || "";
}

async function saveFlightsUI(){
  if (!plan.flights) plan.flights = makeEmptyPlan(plan.days).flights;
  if (!plan.flights.out) plan.flights.out = { date:"", time:"" };
  if (!plan.flights.ret) plan.flights.ret = { date:"", time:"" };
  if (!plan.flights.journey) plan.flights.journey = { outDuration:"", returnDuration:"" };

  plan.flights.out.date = fOutDate?.value || "";
  plan.flights.out.time = fOutTime?.value || "";
  plan.flights.ret.date = fRetDate?.value || "";
  plan.flights.ret.time = fRetTime?.value || "";

  plan.flights.operator = fOperator?.value || "";
  plan.flights.flightCode = fCode?.value || "";

  plan.flights.journey.outDuration = jOut?.value || "";
  plan.flights.journey.returnDuration = jRet?.value || "";
  plan.flights.layoverDuration = layoverDur?.value || "";

  plan.flights.notes = fNotes?.value || "";

  await persistPlan();
  showSaved();
}

async function clearFlightsUI(){
  if (fOutDate) fOutDate.value = "";
  if (fOutTime) fOutTime.value = "";
  if (fRetDate) fRetDate.value = "";
  if (fRetTime) fRetTime.value = "";

  if (fOperator) fOperator.value = "";
  if (fCode) fCode.value = "";

  if (jOut) jOut.value = "";
  if (jRet) jRet.value = "";
  if (layoverDur) layoverDur.value = "";
  if (fNotes) fNotes.value = "";

  plan.flights = makeEmptyPlan(plan.days).flights;
  await persistPlan();
  showSaved();
}

container.querySelector("#save-flights")?.addEventListener("click", saveFlightsUI);
container.querySelector("#clear-flights")?.addEventListener("click", clearFlightsUI);

// Load initial values
loadFlightsUI();



      // Food per day
      const foodDaySelect = container.querySelector('#food-day-select');
      if (foodDaySelect) {
        foodDaySelect.innerHTML = Array.from({length: plan.days}, (_,i)=>`<option value="${i+1}">Day ${i+1}</option>`).join('');
        foodDaySelect.value = "1";
      }

      const setVal = (sel, v)=>{ const el = container.querySelector(sel); if (el) el.value = v || ""; };
      const getVal = (sel)=> (container.querySelector(sel)?.value ?? "");

      function loadFoodForDay(day){
        const f = plan.food[day] || makeEmptyPlan(plan.days).food[day];

        setVal('#breakfast-dish', f.breakfast.dish);
        setVal('#breakfast-dish-desc', f.breakfast.description);
        setVal('#breakfast-hot', f.breakfast.hot);
        setVal('#breakfast-hot-desc', f.breakfast.hotDescription);
        setVal('#breakfast-cold', f.breakfast.cold);
        setVal('#breakfast-cold-desc', f.breakfast.coldDescription);

        setVal('#lunch-dish', f.lunch.dish);
        setVal('#lunch-dish-desc', f.lunch.description);
        setVal('#lunch-hot', f.lunch.hot);
        setVal('#lunch-hot-desc', f.lunch.hotDescription);
        setVal('#lunch-cold', f.lunch.cold);
        setVal('#lunch-cold-desc', f.lunch.coldDescription);

        setVal('#dinner-starter', f.dinner.starter);
        setVal('#dinner-starter-desc', f.dinner.starterDescription);
        setVal('#dinner-main', f.dinner.main);
        setVal('#dinner-main-desc', f.dinner.mainDescription);
        setVal('#dinner-dessert', f.dinner.dessert);
        setVal('#dinner-dessert-desc', f.dinner.dessertDescription);
        setVal('#dinner-alcohol', f.dinner.alcoholic);
        setVal('#dinner-alcohol-desc', f.dinner.alcoholDescription);
        setVal('#dinner-cold', f.dinner.cold);
        setVal('#dinner-cold-desc', f.dinner.coldDescription);
      }

      function saveFoodForDay(day){
        plan.food[day] = {
          breakfast: {
            dish: getVal('#breakfast-dish'),
            description: getVal('#breakfast-dish-desc'),
            hot: getVal('#breakfast-hot'),
            hotDescription: getVal('#breakfast-hot-desc'),
            cold: getVal('#breakfast-cold'),
            coldDescription: getVal('#breakfast-cold-desc')
          },
          lunch: {
            dish: getVal('#lunch-dish'),
            description: getVal('#lunch-dish-desc'),
            hot: getVal('#lunch-hot'),
            hotDescription: getVal('#lunch-hot-desc'),
            cold: getVal('#lunch-cold'),
            coldDescription: getVal('#lunch-cold-desc')
          },
          dinner: {
            starter: getVal('#dinner-starter'),
            starterDescription: getVal('#dinner-starter-desc'),
            main: getVal('#dinner-main'),
            mainDescription: getVal('#dinner-main-desc'),
            dessert: getVal('#dinner-dessert'),
            dessertDescription: getVal('#dinner-dessert-desc'),
            alcoholic: getVal('#dinner-alcohol'),
            alcoholDescription: getVal('#dinner-alcohol-desc'),
            cold: getVal('#dinner-cold'),
            coldDescription: getVal('#dinner-cold-desc'),
            description: ""
          }
        };
      }

      let currentFoodDay = Number(foodDaySelect?.value || 1);
      loadFoodForDay(currentFoodDay);

      foodDaySelect?.addEventListener('change', async ()=>{
        saveFoodForDay(currentFoodDay);
        await persistPlan();
        currentFoodDay = Number(foodDaySelect.value || 1);
        loadFoodForDay(currentFoodDay);
        showSaved();
      });

      container.querySelector('#save-food')?.addEventListener('click', async ()=>{
        saveFoodForDay(currentFoodDay);
        await persistPlan();
        showSaved();
      });

      container.querySelector('#clear-food')?.addEventListener('click', async ()=>{
        [
          '#breakfast-dish','#breakfast-dish-desc','#breakfast-hot','#breakfast-hot-desc','#breakfast-cold','#breakfast-cold-desc',
          '#lunch-dish','#lunch-dish-desc','#lunch-hot','#lunch-hot-desc','#lunch-cold','#lunch-cold-desc',
          '#dinner-starter','#dinner-starter-desc','#dinner-main','#dinner-main-desc','#dinner-dessert','#dinner-dessert-desc',
          '#dinner-alcohol','#dinner-alcohol-desc','#dinner-cold','#dinner-cold-desc'
        ].forEach(sel=> setVal(sel,""));

        plan.food[currentFoodDay] = makeEmptyPlan(plan.days).food[currentFoodDay];
        await persistPlan();
        showSaved();
      });

      const subButtons = container.querySelectorAll('.food-subtabs .tab-btn');
      function activateSubtab(id){
        subButtons.forEach(b=>b.classList.remove('active'));
        container.querySelectorAll('#tab-breakfast,#tab-lunch,#tab-dinner').forEach(p=>p.classList.remove('active'));
        container.querySelector(`.food-subtabs .tab-btn[data-subtab="${id}"]`)?.classList.add('active');
        container.querySelector('#'+id)?.classList.add('active');
      }
      subButtons.forEach(btn=> btn.addEventListener('click', ()=> activateSubtab(btn.dataset.subtab)));

      const notesArea = container.querySelector('#notes-text');
      const tipsArea = container.querySelector('#tips-text');
      if (notesArea) notesArea.value = plan.notes || "";
      if (tipsArea) tipsArea.value = plan.tips || "";

      container.querySelector('#save-notes')?.addEventListener('click', async ()=>{
        plan.notes = notesArea.value; await persistPlan(); showSaved();
      });
      container.querySelector('#clear-notes')?.addEventListener('click', async ()=>{
        notesArea.value=""; plan.notes=""; await persistPlan(); showSaved();
      });

      container.querySelector('#save-tips')?.addEventListener('click', async ()=>{
        plan.tips = tipsArea.value; await persistPlan(); showSaved();
      });
      container.querySelector('#clear-tips')?.addEventListener('click', async ()=>{
        tipsArea.value=""; plan.tips=""; await persistPlan(); showSaved();
      });

      // Init day 1
      if (daysInput) daysInput.value = plan.days;
      if (daySelect) {
        daySelect.innerHTML = "";
        for (let i = 1; i <= plan.days; i++) {
          const opt = document.createElement("option");
          opt.value = String(i);
          opt.textContent = `üìÖ Day ${i} Plan`;
          daySelect.appendChild(opt);
        }
        currentDay = 1;
        daySelect.value = "1";
        loadDayText(currentDay);
      }
    }

    // -------------------------
    // MAP SETUP  ‚úÖ (MAP CREATED BEFORE DEPARTURES INIT)
    // -------------------------
    const map = L.map("map", { zoomControl: true }).setView([48.5, 8], 5);
    window.map = map; // ‚úÖ safe now (map exists)

    window.addEventListener("load", () => {
      setTimeout(() => map.invalidateSize(true), 150);
    });

    const cartoAttr = '&copy; OpenStreetMap contributors, &copy; CARTO';
    L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
      maxZoom: 20,
      subdomains: 'abcd',
      attribution: cartoAttr
    }).addTo(map);

    let allMarkers = [];
    let allLayerGroup;

    function isBlackDotIconPath(path) { return String(path || "").includes("black-dot.png"); }

    function updateIconCounts() {
      const el = document.getElementById("icon-counts");
      if (!el) return;

      let flags = 0;
      let dots = 0;

      const visibleMarkers = allLayerGroup ? allLayerGroup.getLayers() : [];
      for (const m of visibleMarkers) {
        const d = m.destinationData || {};
        if (isBlackDotIconPath(d.destination)) dots++;
        else flags++;
      }
      el.textContent = `üè¥ Flags: ${flags} | ‚ö´ Dots: ${dots}`;
    }

    function renderMap() {
      if (allLayerGroup) map.removeLayer(allLayerGroup);
      allLayerGroup = L.featureGroup().addTo(map);
      allMarkers = [];

      for (const d of destinations) {
        const icon = d.destination ? destinationIcon(d.destination) : undefined;
        const marker = L.marker([d.lat, d.lng], icon ? { icon } : undefined);

        marker.bindPopup(buildPopup(d), { maxWidth: 600 });

        marker.on('popupopen', (e) => {
          const el = e.popup.getElement();
          requestAnimationFrame(() => {
            const container = el.querySelector('.popup');
            if (!container) return;

            L.DomEvent.disableClickPropagation(container);
            L.DomEvent.disableScrollPropagation(container);

            initPopupHandlers(container, d);
          });
        });

        marker.destinationData = d;
        allLayerGroup.addLayer(marker);
        allMarkers.push(marker);
      }

      if (allLayerGroup.getLayers().length > 0) {
        const bounds = allLayerGroup.getBounds();
        if (bounds.isValid()) map.fitBounds(bounds.pad(0.2));
      }

      updateIconCounts();
      setTimeout(() => map.invalidateSize(true), 60);
    }

    window.renderMap = renderMap;

    // ‚úÖ Departures collapse init (MOVED HERE: after map exists)
    (function initDeparturesCollapse(){
      const strip = document.getElementById("departuresStrip");
      const btn = document.getElementById("departuresToggle");
      if (!strip || !btn) return;

      const KEY = "departuresCollapsed";

      function applyState(collapsed){
        strip.classList.toggle("is-collapsed", collapsed);
        btn.setAttribute("aria-expanded", String(!collapsed));
        btn.textContent = collapsed ? "SHOW" : "HIDE";

        document.documentElement.style.setProperty("--strip-space", collapsed ? "10px" : "86px");

        setTimeout(() => {
          try { window.map?.invalidateSize(true); } catch {}
        }, 260);
      }

      const saved = (window.safeStorage?.getItem(KEY) === "1");
      applyState(saved);

      btn.addEventListener("click", () => {
        const nowCollapsed = !strip.classList.contains("is-collapsed");
        applyState(nowCollapsed);
        window.safeStorage?.setItem(KEY, nowCollapsed ? "1" : "0");
      }, { passive: true });
    })();

    // Controls (search/filter)
    document.addEventListener("DOMContentLoaded", () => {
      const searchInput = document.getElementById("search-input");
      const regionFilter = document.getElementById("region-filter");
      const resetBtn = document.getElementById("reset-view");

      function filterMap() {
        const query = searchInput.value.trim().toLowerCase();
        const region = regionFilter.value;

        allMarkers.forEach(marker => {
          const d = marker.destinationData;
          const nameMatch = d.name.toLowerCase().includes(query);
          const regionMatch = (region === "all") || d.region === region;
          if (nameMatch && regionMatch) marker.addTo(allLayerGroup);
          else allLayerGroup.removeLayer(marker);
        });

        if (allLayerGroup.getLayers().length > 0) {
          map.fitBounds(allLayerGroup.getBounds().pad(0.2));
        }

        updateIconCounts();
      }

      searchInput.addEventListener("input", filterMap, { passive: true });
      regionFilter.addEventListener("change", filterMap);
      resetBtn.addEventListener("click", () => {
        searchInput.value = "";
        regionFilter.value = "all";
        renderMap();
      });

      renderMap();
    });
  </script>

  <!-- Firebase SDKs -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js";
    import { doc, setDoc, collection, getDocs, getDoc, initializeFirestore } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCAY-izVSAjouJjL960zS8xs84jaOZQBIo",
      authDomain: "kieranholidaymap.firebaseapp.com",
      projectId: "kieranholidaymap",
      storageBucket: "kieranholidaymap.firebasestorage.app",
      messagingSenderId: "733529027142",
      appId: "1:733529027142:web:f1af423b12491a937dd047"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    const db = initializeFirestore(app, {
      experimentalForceLongPolling: true,
      useFetchStreams: false
    });

    const provider = new GoogleAuthProvider();

    window.firebaseAuth = auth;
    window.firebaseProvider = provider;
    window.firebaseDB = db;

    window.setDoc = setDoc;
    window.doc = doc;
    window.collection = collection;
    window.getDocs = getDocs;
    window.getDoc = getDoc;

    window.firebaseSignIn = () => signInWithPopup(auth, provider);
    window.firebaseSignOut = () => signOut(auth);

    onAuthStateChanged(auth, async (user) => {
      const signInBtn = document.getElementById("sign-in-btn");
      const signOutBtn = document.getElementById("sign-out-btn");
      const userInfo = document.getElementById("user-info");
      const migrateBtn = document.getElementById("migrate-btn");
      const statusBox = document.getElementById("migration-status");

  function showStatus(html, duration = 2000) { // default 2 seconds
  if (!statusBox) return;

  statusBox.innerHTML = html;
  statusBox.classList.add("show");

  // Auto-hide after duration
  setTimeout(() => {
    statusBox.classList.remove("show");
  }, duration);
}

      if (user) {
        signInBtn.style.display = "none";
        signOutBtn.style.display = "inline-block";
        userInfo.textContent = `Signed in as: ${user.displayName}`;
        migrateBtn.style.display = (user.email === "kcco1996@gmail.com") ? "inline-block" : "none";

        updateBarsLayout();

        let count = 0;
        try {
          const snap = await getDocs(collection(db, "users", user.uid, "plans"));
          snap.forEach((docSnap) => {
            const id = docSnap.id;
            const canonical = window.canonicalDestinationName ? window.canonicalDestinationName(id) : id;
            window.safeStorage.setItem(`hasPlan:${canonical}`, "1");
            count++;
          });

          showStatus(
            `‚úÖ Firebase index loaded<br>` +
            `Plans found: <b>${count}</b><br><br>` +
            `Popups will fetch the full plan from Firebase when opened.`
          );
        } catch (e) {
          console.warn("Firebase index load failed:", e);
          showStatus(`‚ùå Firebase index load failed: ${e.message}`);
        }

        window.renderMap?.();
      } else {
        signInBtn.style.display = "inline-block";
        signOutBtn.style.display = "none";
        userInfo.textContent = "";
        migrateBtn.style.display = "none";

        updateBarsLayout();

        if (statusBox) {
          statusBox.style.display = "none";
          statusBox.innerHTML = "";
        }
      }
    });

    // Migration button: read local (chunked) -> Firebase
    document.addEventListener("DOMContentLoaded", () => {
      const migrateBtn = document.getElementById("migrate-btn");
      if (!migrateBtn) return;

      migrateBtn.addEventListener("click", async () => {
        const user = auth.currentUser;
        if (!user) return;

        const statusBox = document.getElementById("migration-status");
       showStatus("‚è≥ Starting migration‚Ä¶", 10000);

        const keys = (window.safeStorage.keys() || [])
          .filter(k => k.startsWith("tripPlan:") && k.endsWith("::__chunks"))
          .map(k => k.replace("::__chunks",""));

        if (keys.length === 0) {
          statusBox.innerHTML = "‚ùå No local plans found.";
          return;
        }

        for (const baseKey of keys) {
          const name = baseKey.replace("tripPlan:", "");
          let data;
          try {
            data = window.loadPlanLocal(name);
          } catch {
            data = null;
          }

          if (!data) {
            const line = document.createElement("div");
            line.textContent = `‚ùå Skipped "${name}" (could not load).`;
            showStatus(line.textContent, 10000);
            continue;
          }

          try {
            await setDoc(doc(db, "users", user.uid, "plans", name), { name, data, updatedAt: Date.now() }, { merge: true });
            const line = document.createElement("div");
            line.textContent = `‚úÖ Migrated "${name}" to Firebase.`;
            showStatus(line.textContent, 10000);
          } catch (err) {
            const line = document.createElement("div");
            line.textContent = `‚ùå Failed to migrate "${name}": ${err.message}`;
            showStatus(line.textContent, 10000);
          }
        }
      });
    });
  </script>
</body>
</html>